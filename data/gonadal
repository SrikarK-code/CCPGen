{"cells":[{"cell_type":"markdown","metadata":{"id":"_rjYSzJaDPyu"},"source":["## anndata, scanpy imports"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":24145,"status":"ok","timestamp":1726177657623,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"XMEgQ56vy9IF","outputId":"b4e8c692-feee-4558-ba89-3be537f53e86"},"outputs":[{"name":"stdout","output_type":"stream","text":["Collecting anndata\n","  Downloading anndata-0.10.9-py3-none-any.whl.metadata (6.9 kB)\n","Collecting scanpy\n","  Downloading scanpy-1.10.2-py3-none-any.whl.metadata (9.3 kB)\n","Collecting array-api-compat!=1.5,>1.4 (from anndata)\n","  Downloading array_api_compat-1.8-py3-none-any.whl.metadata (1.5 kB)\n","Requirement already satisfied: exceptiongroup in /usr/local/lib/python3.10/dist-packages (from anndata) (1.2.2)\n","Requirement already satisfied: h5py>=3.1 in /usr/local/lib/python3.10/dist-packages (from anndata) (3.11.0)\n","Requirement already satisfied: natsort in /usr/local/lib/python3.10/dist-packages (from anndata) (8.4.0)\n","Requirement already satisfied: numpy>=1.23 in /usr/local/lib/python3.10/dist-packages (from anndata) (1.26.4)\n","Requirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.10/dist-packages (from anndata) (24.1)\n","Requirement already satisfied: pandas!=2.1.0rc0,!=2.1.2,>=1.4 in /usr/local/lib/python3.10/dist-packages (from anndata) (2.1.4)\n","Requirement already satisfied: scipy>1.8 in /usr/local/lib/python3.10/dist-packages (from anndata) (1.13.1)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.10/dist-packages (from scanpy) (1.4.2)\n","Collecting legacy-api-wrap>=1.4 (from scanpy)\n","  Downloading legacy_api_wrap-1.4-py3-none-any.whl.metadata (1.8 kB)\n","Requirement already satisfied: matplotlib>=3.6 in /usr/local/lib/python3.10/dist-packages (from scanpy) (3.7.1)\n","Requirement already satisfied: networkx>=2.7 in /usr/local/lib/python3.10/dist-packages (from scanpy) (3.3)\n","Requirement already satisfied: numba>=0.56 in /usr/local/lib/python3.10/dist-packages (from scanpy) (0.60.0)\n","Requirement already satisfied: patsy in /usr/local/lib/python3.10/dist-packages (from scanpy) (0.5.6)\n","Collecting pynndescent>=0.5 (from scanpy)\n","  Downloading pynndescent-0.5.13-py3-none-any.whl.metadata (6.8 kB)\n","Requirement already satisfied: scikit-learn>=0.24 in /usr/local/lib/python3.10/dist-packages (from scanpy) (1.3.2)\n","Requirement already satisfied: seaborn>=0.13 in /usr/local/lib/python3.10/dist-packages (from scanpy) (0.13.1)\n","Collecting session-info (from scanpy)\n","  Downloading session_info-1.0.0.tar.gz (24 kB)\n","  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Requirement already satisfied: statsmodels>=0.13 in /usr/local/lib/python3.10/dist-packages (from scanpy) (0.14.2)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.10/dist-packages (from scanpy) (4.66.5)\n","Collecting umap-learn!=0.5.0,>=0.5 (from scanpy)\n","  Downloading umap_learn-0.5.6-py3-none-any.whl.metadata (21 kB)\n","Requirement already satisfied: contourpy>=1.0.1 in /usr/local/lib/python3.10/dist-packages (from matplotlib>=3.6->scanpy) (1.3.0)\n","Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.10/dist-packages (from matplotlib>=3.6->scanpy) (0.12.1)\n","Requirement already satisfied: fonttools>=4.22.0 in /usr/local/lib/python3.10/dist-packages (from matplotlib>=3.6->scanpy) (4.53.1)\n","Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.10/dist-packages (from matplotlib>=3.6->scanpy) (1.4.7)\n","Requirement already satisfied: pillow>=6.2.0 in /usr/local/lib/python3.10/dist-packages (from matplotlib>=3.6->scanpy) (9.4.0)\n","Requirement already satisfied: pyparsing>=2.3.1 in /usr/local/lib/python3.10/dist-packages (from matplotlib>=3.6->scanpy) (3.1.4)\n","Requirement already satisfied: python-dateutil>=2.7 in /usr/local/lib/python3.10/dist-packages (from matplotlib>=3.6->scanpy) (2.8.2)\n","Requirement already satisfied: llvmlite<0.44,>=0.43.0dev0 in /usr/local/lib/python3.10/dist-packages (from numba>=0.56->scanpy) (0.43.0)\n","Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas!=2.1.0rc0,!=2.1.2,>=1.4->anndata) (2024.1)\n","Requirement already satisfied: tzdata>=2022.1 in /usr/local/lib/python3.10/dist-packages (from pandas!=2.1.0rc0,!=2.1.2,>=1.4->anndata) (2024.1)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.10/dist-packages (from scikit-learn>=0.24->scanpy) (3.5.0)\n","Requirement already satisfied: six in /usr/local/lib/python3.10/dist-packages (from patsy->scanpy) (1.16.0)\n","Collecting stdlib_list (from session-info->scanpy)\n","  Downloading stdlib_list-0.10.0-py3-none-any.whl.metadata (3.3 kB)\n","Downloading anndata-0.10.9-py3-none-any.whl (128 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m129.0/129.0 kB\u001b[0m \u001b[31m2.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading scanpy-1.10.2-py3-none-any.whl (2.1 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m2.1/2.1 MB\u001b[0m \u001b[31m14.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading array_api_compat-1.8-py3-none-any.whl (38 kB)\n","Downloading legacy_api_wrap-1.4-py3-none-any.whl (15 kB)\n","Downloading pynndescent-0.5.13-py3-none-any.whl (56 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m56.9/56.9 kB\u001b[0m \u001b[31m1.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading umap_learn-0.5.6-py3-none-any.whl (85 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m85.7/85.7 kB\u001b[0m \u001b[31m3.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading stdlib_list-0.10.0-py3-none-any.whl (79 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m79.8/79.8 kB\u001b[0m \u001b[31m2.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hBuilding wheels for collected packages: session-info\n","  Building wheel for session-info (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for session-info: filename=session_info-1.0.0-py3-none-any.whl size=8023 sha256=77a4b3255ea3c1d4ea41511c11a3c58851ee9618290e714d7cf2ead92a4bbed5\n","  Stored in directory: /root/.cache/pip/wheels/6a/aa/b9/eb5d4031476ec10802795b97ccf937b9bd998d68a9b268765a\n","Successfully built session-info\n","Installing collected packages: array-api-compat, stdlib_list, legacy-api-wrap, session-info, pynndescent, anndata, umap-learn, scanpy\n","Successfully installed anndata-0.10.9 array-api-compat-1.8 legacy-api-wrap-1.4 pynndescent-0.5.13 scanpy-1.10.2 session-info-1.0.0 stdlib_list-0.10.0 umap-learn-0.5.6\n"]}],"source":["!pip install anndata scanpy"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"GLPFCfa-yF8F"},"outputs":[],"source":["import anndata as ad\n","import scanpy as sc"]},{"cell_type":"markdown","metadata":{"id":"S5jLIxFWDJUX"},"source":["## creating anndata"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"T1fySLO-zjC4"},"outputs":[],"source":["import os"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"BhnvyavMzBXX"},"outputs":[],"source":["os.chdir('/content/drive/MyDrive/Programmable Biology Group/Srikar/tf-flow-design/gonadal/data')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":204,"status":"ok","timestamp":1726154262791,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"1yAfDJIrzt5s","outputId":"4e5ca1d7-0e03-44cd-d0e0-a24d9e1e50fc"},"outputs":[{"name":"stdout","output_type":"stream","text":["GSM7147764_Sample_1_barcodes.tsv.gz  GSM7837923_Mono_iPSC1_D0_barcodes.tsv.gz  human_germcells.h5ad\n","GSM7147764_Sample_1_features.tsv.gz  GSM7837923_Mono_iPSC1_D0_features.tsv.gz\n","GSM7147764_Sample_1_matrix.mtx.gz    GSM7837923_Mono_iPSC1_D0_matrix.mtx.gz\n"]}],"source":["!ls"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":34126,"status":"ok","timestamp":1726157350054,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"jFsKaeGTz82M","outputId":"4dd797d0-ec53-4053-f73b-09d4c751acc7"},"outputs":[{"name":"stdout","output_type":"stream","text":["7708\n","36601\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/anndata.py:821: UserWarning: \n","AnnData expects .obs.index to contain strings, but got values like:\n","    [('AAACCCAAGGTCACCC-1',), ('AAACCCACATGTGGCC-1',), ('AAACCCAGTGATATAG-1',), ('AAACCCAGTGGCTGAA-1',), ('AAACCCATCCCTTCCC-1',)]\n","\n","    Inferred to be: mixed\n","\n","  names = self._prep_dim_index(names, \"obs\")\n"]},{"name":"stdout","output_type":"stream","text":["15909\n","36602\n","AnnData object with n_obs × n_vars = 7708 × 36601\n","AnnData object with n_obs × n_vars = 15909 × 36602\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/anndata.py:821: UserWarning: \n","AnnData expects .obs.index to contain strings, but got values like:\n","    [('AAACCCAAGCATACTC-1',), ('AAACCCAAGGCCACTC-1',), ('AAACCCAAGGCTTTCA-1',), ('AAACCCAAGGTCATCT-1',), ('AAACCCACAAGGCCTC-1',)]\n","\n","    Inferred to be: mixed\n","\n","  names = self._prep_dim_index(names, \"obs\")\n"]}],"source":["import scanpy as sc\n","import anndata\n","import scipy.io\n","import pandas as pd\n","\n","def read_10x_files(matrix_file, barcodes_file, features_file):\n","    matrix = scipy.io.mmread(matrix_file).tocsr().transpose()\n","    barcodes = pd.read_csv(barcodes_file, header=None).values\n","    features = pd.read_csv(features_file, header=None, sep='\\t')[1].values\n","    adata = anndata.AnnData(X=matrix)\n","    print(len(barcodes))\n","    print(len(features))\n","    adata.obs_names = barcodes\n","    adata.var_names = features\n","    return adata\n","\n","matrix_file_7147764 = 'GSM7147764_Sample_1_matrix.mtx.gz'\n","barcodes_file_7147764 = 'GSM7147764_Sample_1_barcodes.tsv.gz'\n","features_file_7147764 = 'GSM7147764_Sample_1_features.tsv.gz'\n","\n","matrix_file_7837923 = 'GSM7837923_Mono_iPSC1_D0_matrix.mtx.gz'\n","barcodes_file_7837923 = 'GSM7837923_Mono_iPSC1_D0_barcodes.tsv.gz'\n","features_file_7837923 = 'GSM7837923_Mono_iPSC1_D0_features.tsv.gz'\n","\n","adata_7147764 = read_10x_files(matrix_file_7147764, barcodes_file_7147764, features_file_7147764)\n","adata_7837923 = read_10x_files(matrix_file_7837923, barcodes_file_7837923, features_file_7837923)\n","\n","print(adata_7147764)\n","print(adata_7837923)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"RtcSiz8J7osk"},"outputs":[],"source":["adata_gonad = sc.read_h5ad(\"human_germcells.h5ad\")"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":443},"executionInfo":{"elapsed":168,"status":"ok","timestamp":1726157500010,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"cWp_P_xR783t","outputId":"19b282d6-d6a5-4b7c-d6ec-126045b85431"},"outputs":[{"data":{"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe"},"text/html":["\n","  <div id=\"df-ad837e6b-9a51-4468-a715-3d2f04762eaf\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>n_genes</th>\n","      <th>sample</th>\n","      <th>donor</th>\n","      <th>location</th>\n","      <th>sex</th>\n","      <th>enrichment</th>\n","      <th>cryopreserved</th>\n","      <th>TP</th>\n","      <th>10xKit</th>\n","      <th>dig_protocol</th>\n","      <th>...</th>\n","      <th>scrublet_cluster_score</th>\n","      <th>zscore</th>\n","      <th>bh_pval</th>\n","      <th>bonf_pval</th>\n","      <th>is_doublet</th>\n","      <th>PCW</th>\n","      <th>sample_source</th>\n","      <th>trimester</th>\n","      <th>celltype</th>\n","      <th>lineage</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>FCA_GND8047885_AAGACCTCAGTATAAG</th>\n","      <td>3446</td>\n","      <td>FCA_GND8047885</td>\n","      <td>F81</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>CD45-</td>\n","      <td>No</td>\n","      <td>U</td>\n","      <td>5v1.1</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>0.220217</td>\n","      <td>2.931722</td>\n","      <td>0.029851</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>8.8</td>\n","      <td>N</td>\n","      <td>1st</td>\n","      <td>PGC</td>\n","      <td>GermCells</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND8047885_AAGGTTCAGTTAAGTG</th>\n","      <td>3821</td>\n","      <td>FCA_GND8047885</td>\n","      <td>F81</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>CD45-</td>\n","      <td>No</td>\n","      <td>U</td>\n","      <td>5v1.1</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>0.220217</td>\n","      <td>2.931722</td>\n","      <td>0.029851</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>8.8</td>\n","      <td>N</td>\n","      <td>1st</td>\n","      <td>PGC</td>\n","      <td>GermCells</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND8047885_CCTCTGAAGTGACATA</th>\n","      <td>4123</td>\n","      <td>FCA_GND8047885</td>\n","      <td>F81</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>CD45-</td>\n","      <td>No</td>\n","      <td>U</td>\n","      <td>5v1.1</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>0.117446</td>\n","      <td>0.595275</td>\n","      <td>0.896849</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>8.8</td>\n","      <td>N</td>\n","      <td>1st</td>\n","      <td>PGC</td>\n","      <td>GermCells</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND8047885_CGAACATAGCCGGTAA</th>\n","      <td>4494</td>\n","      <td>FCA_GND8047885</td>\n","      <td>F81</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>CD45-</td>\n","      <td>No</td>\n","      <td>U</td>\n","      <td>5v1.1</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>0.078969</td>\n","      <td>-0.279482</td>\n","      <td>0.896849</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>8.8</td>\n","      <td>N</td>\n","      <td>1st</td>\n","      <td>PGC</td>\n","      <td>GermCells</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND8047885_CGTGAGCTCATCATTC</th>\n","      <td>3152</td>\n","      <td>FCA_GND8047885</td>\n","      <td>F81</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>CD45-</td>\n","      <td>No</td>\n","      <td>U</td>\n","      <td>5v1.1</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>0.117446</td>\n","      <td>0.595275</td>\n","      <td>0.896849</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>8.8</td>\n","      <td>N</td>\n","      <td>1st</td>\n","      <td>PGC</td>\n","      <td>GermCells</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>HCA_F_GON10941968_CTCTACGGTTGATTCG</th>\n","      <td>6073</td>\n","      <td>HCA_F_GON10941968</td>\n","      <td>Hrv99</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>total</td>\n","      <td>No</td>\n","      <td>Sur</td>\n","      <td>5DUAL</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>0.121339</td>\n","      <td>1.534958</td>\n","      <td>0.766914</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>8.0</td>\n","      <td>L</td>\n","      <td>1st</td>\n","      <td>PGC</td>\n","      <td>GermCells</td>\n","    </tr>\n","    <tr>\n","      <th>HCA_F_GON10941968_GCACTCTCAGTCACTA</th>\n","      <td>628</td>\n","      <td>HCA_F_GON10941968</td>\n","      <td>Hrv99</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>total</td>\n","      <td>No</td>\n","      <td>Sur</td>\n","      <td>5DUAL</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>0.121339</td>\n","      <td>1.534958</td>\n","      <td>0.766914</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>8.0</td>\n","      <td>L</td>\n","      <td>1st</td>\n","      <td>PGC</td>\n","      <td>GermCells</td>\n","    </tr>\n","    <tr>\n","      <th>HCA_F_GON10941968_TTTATGCAGTAGCGGT</th>\n","      <td>1403</td>\n","      <td>HCA_F_GON10941968</td>\n","      <td>Hrv99</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>total</td>\n","      <td>No</td>\n","      <td>Sur</td>\n","      <td>5DUAL</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>0.121339</td>\n","      <td>1.534958</td>\n","      <td>0.766914</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>8.0</td>\n","      <td>L</td>\n","      <td>1st</td>\n","      <td>PGC</td>\n","      <td>GermCells</td>\n","    </tr>\n","    <tr>\n","      <th>HCA_F_GON10941969_AAGTCTGCAAGGTTCT</th>\n","      <td>6188</td>\n","      <td>HCA_F_GON10941969</td>\n","      <td>Hrv99</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>total</td>\n","      <td>No</td>\n","      <td>Sur</td>\n","      <td>5DUAL</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>0.150000</td>\n","      <td>2.824481</td>\n","      <td>0.099091</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>8.0</td>\n","      <td>L</td>\n","      <td>1st</td>\n","      <td>PGC</td>\n","      <td>GermCells</td>\n","    </tr>\n","    <tr>\n","      <th>HCA_F_GON10941969_ACCGTAATCTTCGGTC</th>\n","      <td>5340</td>\n","      <td>HCA_F_GON10941969</td>\n","      <td>Hrv99</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>total</td>\n","      <td>No</td>\n","      <td>Sur</td>\n","      <td>5DUAL</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>0.150000</td>\n","      <td>2.824481</td>\n","      <td>0.099091</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>8.0</td>\n","      <td>L</td>\n","      <td>1st</td>\n","      <td>PGC</td>\n","      <td>GermCells</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>10993 rows × 29 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-ad837e6b-9a51-4468-a715-3d2f04762eaf')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-ad837e6b-9a51-4468-a715-3d2f04762eaf button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-ad837e6b-9a51-4468-a715-3d2f04762eaf');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-1319bbc7-546b-4ce5-aeb5-4ac437eafddc\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-1319bbc7-546b-4ce5-aeb5-4ac437eafddc')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-1319bbc7-546b-4ce5-aeb5-4ac437eafddc button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","\n","    </div>\n","  </div>\n"],"text/plain":["                                    n_genes             sample  donor  \\\n","FCA_GND8047885_AAGACCTCAGTATAAG        3446     FCA_GND8047885    F81   \n","FCA_GND8047885_AAGGTTCAGTTAAGTG        3821     FCA_GND8047885    F81   \n","FCA_GND8047885_CCTCTGAAGTGACATA        4123     FCA_GND8047885    F81   \n","FCA_GND8047885_CGAACATAGCCGGTAA        4494     FCA_GND8047885    F81   \n","FCA_GND8047885_CGTGAGCTCATCATTC        3152     FCA_GND8047885    F81   \n","...                                     ...                ...    ...   \n","HCA_F_GON10941968_CTCTACGGTTGATTCG     6073  HCA_F_GON10941968  Hrv99   \n","HCA_F_GON10941968_GCACTCTCAGTCACTA      628  HCA_F_GON10941968  Hrv99   \n","HCA_F_GON10941968_TTTATGCAGTAGCGGT     1403  HCA_F_GON10941968  Hrv99   \n","HCA_F_GON10941969_AAGTCTGCAAGGTTCT     6188  HCA_F_GON10941969  Hrv99   \n","HCA_F_GON10941969_ACCGTAATCTTCGGTC     5340  HCA_F_GON10941969  Hrv99   \n","\n","                                                  location     sex enrichment  \\\n","FCA_GND8047885_AAGACCTCAGTATAAG     Gonad_and_extragonadal  female      CD45-   \n","FCA_GND8047885_AAGGTTCAGTTAAGTG     Gonad_and_extragonadal  female      CD45-   \n","FCA_GND8047885_CCTCTGAAGTGACATA     Gonad_and_extragonadal  female      CD45-   \n","FCA_GND8047885_CGAACATAGCCGGTAA     Gonad_and_extragonadal  female      CD45-   \n","FCA_GND8047885_CGTGAGCTCATCATTC     Gonad_and_extragonadal  female      CD45-   \n","...                                                    ...     ...        ...   \n","HCA_F_GON10941968_CTCTACGGTTGATTCG  Gonad_and_extragonadal  female      total   \n","HCA_F_GON10941968_GCACTCTCAGTCACTA  Gonad_and_extragonadal  female      total   \n","HCA_F_GON10941968_TTTATGCAGTAGCGGT  Gonad_and_extragonadal  female      total   \n","HCA_F_GON10941969_AAGTCTGCAAGGTTCT  Gonad_and_extragonadal  female      total   \n","HCA_F_GON10941969_ACCGTAATCTTCGGTC  Gonad_and_extragonadal  female      total   \n","\n","                                   cryopreserved   TP 10xKit dig_protocol  \\\n","FCA_GND8047885_AAGACCTCAGTATAAG               No    U  5v1.1       P_tryp   \n","FCA_GND8047885_AAGGTTCAGTTAAGTG               No    U  5v1.1       P_tryp   \n","FCA_GND8047885_CCTCTGAAGTGACATA               No    U  5v1.1       P_tryp   \n","FCA_GND8047885_CGAACATAGCCGGTAA               No    U  5v1.1       P_tryp   \n","FCA_GND8047885_CGTGAGCTCATCATTC               No    U  5v1.1       P_tryp   \n","...                                          ...  ...    ...          ...   \n","HCA_F_GON10941968_CTCTACGGTTGATTCG            No  Sur  5DUAL       P_tryp   \n","HCA_F_GON10941968_GCACTCTCAGTCACTA            No  Sur  5DUAL       P_tryp   \n","HCA_F_GON10941968_TTTATGCAGTAGCGGT            No  Sur  5DUAL       P_tryp   \n","HCA_F_GON10941969_AAGTCTGCAAGGTTCT            No  Sur  5DUAL       P_tryp   \n","HCA_F_GON10941969_ACCGTAATCTTCGGTC            No  Sur  5DUAL       P_tryp   \n","\n","                                    ...  scrublet_cluster_score    zscore  \\\n","FCA_GND8047885_AAGACCTCAGTATAAG     ...                0.220217  2.931722   \n","FCA_GND8047885_AAGGTTCAGTTAAGTG     ...                0.220217  2.931722   \n","FCA_GND8047885_CCTCTGAAGTGACATA     ...                0.117446  0.595275   \n","FCA_GND8047885_CGAACATAGCCGGTAA     ...                0.078969 -0.279482   \n","FCA_GND8047885_CGTGAGCTCATCATTC     ...                0.117446  0.595275   \n","...                                 ...                     ...       ...   \n","HCA_F_GON10941968_CTCTACGGTTGATTCG  ...                0.121339  1.534958   \n","HCA_F_GON10941968_GCACTCTCAGTCACTA  ...                0.121339  1.534958   \n","HCA_F_GON10941968_TTTATGCAGTAGCGGT  ...                0.121339  1.534958   \n","HCA_F_GON10941969_AAGTCTGCAAGGTTCT  ...                0.150000  2.824481   \n","HCA_F_GON10941969_ACCGTAATCTTCGGTC  ...                0.150000  2.824481   \n","\n","                                     bh_pval bonf_pval is_doublet  PCW  \\\n","FCA_GND8047885_AAGACCTCAGTATAAG     0.029851       1.0      False  8.8   \n","FCA_GND8047885_AAGGTTCAGTTAAGTG     0.029851       1.0      False  8.8   \n","FCA_GND8047885_CCTCTGAAGTGACATA     0.896849       1.0      False  8.8   \n","FCA_GND8047885_CGAACATAGCCGGTAA     0.896849       1.0      False  8.8   \n","FCA_GND8047885_CGTGAGCTCATCATTC     0.896849       1.0      False  8.8   \n","...                                      ...       ...        ...  ...   \n","HCA_F_GON10941968_CTCTACGGTTGATTCG  0.766914       1.0      False  8.0   \n","HCA_F_GON10941968_GCACTCTCAGTCACTA  0.766914       1.0      False  8.0   \n","HCA_F_GON10941968_TTTATGCAGTAGCGGT  0.766914       1.0      False  8.0   \n","HCA_F_GON10941969_AAGTCTGCAAGGTTCT  0.099091       1.0      False  8.0   \n","HCA_F_GON10941969_ACCGTAATCTTCGGTC  0.099091       1.0      False  8.0   \n","\n","                                    sample_source trimester  celltype  \\\n","FCA_GND8047885_AAGACCTCAGTATAAG                 N       1st       PGC   \n","FCA_GND8047885_AAGGTTCAGTTAAGTG                 N       1st       PGC   \n","FCA_GND8047885_CCTCTGAAGTGACATA                 N       1st       PGC   \n","FCA_GND8047885_CGAACATAGCCGGTAA                 N       1st       PGC   \n","FCA_GND8047885_CGTGAGCTCATCATTC                 N       1st       PGC   \n","...                                           ...       ...       ...   \n","HCA_F_GON10941968_CTCTACGGTTGATTCG              L       1st       PGC   \n","HCA_F_GON10941968_GCACTCTCAGTCACTA              L       1st       PGC   \n","HCA_F_GON10941968_TTTATGCAGTAGCGGT              L       1st       PGC   \n","HCA_F_GON10941969_AAGTCTGCAAGGTTCT              L       1st       PGC   \n","HCA_F_GON10941969_ACCGTAATCTTCGGTC              L       1st       PGC   \n","\n","                                      lineage  \n","FCA_GND8047885_AAGACCTCAGTATAAG     GermCells  \n","FCA_GND8047885_AAGGTTCAGTTAAGTG     GermCells  \n","FCA_GND8047885_CCTCTGAAGTGACATA     GermCells  \n","FCA_GND8047885_CGAACATAGCCGGTAA     GermCells  \n","FCA_GND8047885_CGTGAGCTCATCATTC     GermCells  \n","...                                       ...  \n","HCA_F_GON10941968_CTCTACGGTTGATTCG  GermCells  \n","HCA_F_GON10941968_GCACTCTCAGTCACTA  GermCells  \n","HCA_F_GON10941968_TTTATGCAGTAGCGGT  GermCells  \n","HCA_F_GON10941969_AAGTCTGCAAGGTTCT  GermCells  \n","HCA_F_GON10941969_ACCGTAATCTTCGGTC  GermCells  \n","\n","[10993 rows x 29 columns]"]},"execution_count":57,"metadata":{},"output_type":"execute_result"}],"source":["adata_gonad.obs"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"IcygDet88eo7"},"outputs":[],"source":["for adata in [adata_7147764, adata_7837923]:\n","    adata.obs['celltype'] = 'ipsc'"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":423},"executionInfo":{"elapsed":4,"status":"ok","timestamp":1726157350054,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"1YeidS3Y8hLO","outputId":"e6bc496c-33ff-453d-e259-d7d77aad19e1"},"outputs":[{"data":{"application/vnd.google.colaboratory.intrinsic+json":{"summary":"{\n  \"name\": \"adata_7147764\",\n  \"rows\": 7708,\n  \"fields\": [\n    {\n      \"column\": \"celltype\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          \"ipsc\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}","type":"dataframe"},"text/html":["\n","  <div id=\"df-22a8115b-2864-47ca-b160-da7d656909dd\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>celltype</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>(AAACCCAAGGTCACCC-1,)</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>(AAACCCACATGTGGCC-1,)</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>(AAACCCAGTGATATAG-1,)</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>(AAACCCAGTGGCTGAA-1,)</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>(AAACCCATCCCTTCCC-1,)</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>(TTTGTTGCATGACGAG-1,)</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>(TTTGTTGGTAACGTTC-1,)</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>(TTTGTTGGTTGAAGTA-1,)</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>(TTTGTTGTCCGGCTTT-1,)</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>(TTTGTTGTCGCAATTG-1,)</th>\n","      <td>ipsc</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>7708 rows × 1 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-22a8115b-2864-47ca-b160-da7d656909dd')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-22a8115b-2864-47ca-b160-da7d656909dd button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-22a8115b-2864-47ca-b160-da7d656909dd');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-5362e82b-a84f-4f8d-b550-13a8ba7368a2\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-5362e82b-a84f-4f8d-b550-13a8ba7368a2')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-5362e82b-a84f-4f8d-b550-13a8ba7368a2 button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","\n","    </div>\n","  </div>\n"],"text/plain":["                      celltype\n","(AAACCCAAGGTCACCC-1,)     ipsc\n","(AAACCCACATGTGGCC-1,)     ipsc\n","(AAACCCAGTGATATAG-1,)     ipsc\n","(AAACCCAGTGGCTGAA-1,)     ipsc\n","(AAACCCATCCCTTCCC-1,)     ipsc\n","...                        ...\n","(TTTGTTGCATGACGAG-1,)     ipsc\n","(TTTGTTGGTAACGTTC-1,)     ipsc\n","(TTTGTTGGTTGAAGTA-1,)     ipsc\n","(TTTGTTGTCCGGCTTT-1,)     ipsc\n","(TTTGTTGTCGCAATTG-1,)     ipsc\n","\n","[7708 rows x 1 columns]"]},"execution_count":51,"metadata":{},"output_type":"execute_result"}],"source":["adata_7147764.obs"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":17973,"status":"ok","timestamp":1726156762991,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"Y0989AdF9ZN4","outputId":"319e1cd6-e44b-48ed-ad70-dc39be5bdc72"},"outputs":[{"name":"stdout","output_type":"stream","text":["Collecting pyensembl\n","  Downloading pyensembl-2.3.13-py3-none-any.whl.metadata (9.4 kB)\n","Collecting typechecks<1.0.0,>=0.0.2 (from pyensembl)\n","  Downloading typechecks-0.1.0.tar.gz (3.4 kB)\n","  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Collecting datacache<2.0.0,>=1.4.0 (from pyensembl)\n","  Downloading datacache-1.4.1-py3-none-any.whl.metadata (1.9 kB)\n","Collecting memoized-property>=1.0.2 (from pyensembl)\n","  Downloading memoized-property-1.0.3.tar.gz (5.0 kB)\n","  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Collecting tinytimer<1.0.0,>=0.0.0 (from pyensembl)\n","  Downloading tinytimer-0.0.0.tar.gz (2.1 kB)\n","  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Collecting gtfparse<3.0.0,>=2.5.0 (from pyensembl)\n","  Downloading gtfparse-2.5.0-py3-none-any.whl.metadata (2.1 kB)\n","Collecting serializable<1.0.0,>=0.2.1 (from pyensembl)\n","  Downloading serializable-0.4.1-py3-none-any.whl.metadata (2.2 kB)\n","Collecting pylint<3.0.0,>=2.17.2 (from pyensembl)\n","  Downloading pylint-2.17.7-py3-none-any.whl.metadata (12 kB)\n","Requirement already satisfied: pandas>=0.15.2 in /usr/local/lib/python3.10/dist-packages (from datacache<2.0.0,>=1.4.0->pyensembl) (2.1.4)\n","Collecting appdirs>=1.4.0 (from datacache<2.0.0,>=1.4.0->pyensembl)\n","  Downloading appdirs-1.4.4-py2.py3-none-any.whl.metadata (9.0 kB)\n","Collecting progressbar33>=2.4 (from datacache<2.0.0,>=1.4.0->pyensembl)\n","  Downloading progressbar33-2.4.tar.gz (10 kB)\n","  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Requirement already satisfied: requests>=2.5.1 in /usr/local/lib/python3.10/dist-packages (from datacache<2.0.0,>=1.4.0->pyensembl) (2.32.3)\n","Collecting mock (from datacache<2.0.0,>=1.4.0->pyensembl)\n","  Downloading mock-5.1.0-py3-none-any.whl.metadata (3.0 kB)\n","Requirement already satisfied: polars<0.21.0,>=0.20.2 in /usr/local/lib/python3.10/dist-packages (from gtfparse<3.0.0,>=2.5.0->pyensembl) (0.20.2)\n","Requirement already satisfied: pyarrow<14.1.0,>=14.0.2 in /usr/local/lib/python3.10/dist-packages (from gtfparse<3.0.0,>=2.5.0->pyensembl) (14.0.2)\n","Requirement already satisfied: platformdirs>=2.2.0 in /usr/local/lib/python3.10/dist-packages (from pylint<3.0.0,>=2.17.2->pyensembl) (4.3.2)\n","Collecting astroid<=2.17.0-dev0,>=2.15.8 (from pylint<3.0.0,>=2.17.2->pyensembl)\n","  Downloading astroid-2.15.8-py3-none-any.whl.metadata (4.7 kB)\n","Collecting isort<6,>=4.2.5 (from pylint<3.0.0,>=2.17.2->pyensembl)\n","  Downloading isort-5.13.2-py3-none-any.whl.metadata (12 kB)\n","Collecting mccabe<0.8,>=0.6 (from pylint<3.0.0,>=2.17.2->pyensembl)\n","  Downloading mccabe-0.7.0-py2.py3-none-any.whl.metadata (5.0 kB)\n","Requirement already satisfied: tomlkit>=0.10.1 in /usr/local/lib/python3.10/dist-packages (from pylint<3.0.0,>=2.17.2->pyensembl) (0.13.2)\n","Collecting dill>=0.2 (from pylint<3.0.0,>=2.17.2->pyensembl)\n","  Downloading dill-0.3.8-py3-none-any.whl.metadata (10 kB)\n","Requirement already satisfied: tomli>=1.1.0 in /usr/local/lib/python3.10/dist-packages (from pylint<3.0.0,>=2.17.2->pyensembl) (2.0.1)\n","Collecting simplejson (from serializable<1.0.0,>=0.2.1->pyensembl)\n","  Downloading simplejson-3.19.3-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.2 kB)\n","Collecting lazy-object-proxy>=1.4.0 (from astroid<=2.17.0-dev0,>=2.15.8->pylint<3.0.0,>=2.17.2->pyensembl)\n","  Downloading lazy_object_proxy-1.10.0-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (7.8 kB)\n","Requirement already satisfied: wrapt<2,>=1.11 in /usr/local/lib/python3.10/dist-packages (from astroid<=2.17.0-dev0,>=2.15.8->pylint<3.0.0,>=2.17.2->pyensembl) (1.16.0)\n","Requirement already satisfied: typing-extensions>=4.0.0 in /usr/local/lib/python3.10/dist-packages (from astroid<=2.17.0-dev0,>=2.15.8->pylint<3.0.0,>=2.17.2->pyensembl) (4.12.2)\n","Requirement already satisfied: numpy<2,>=1.22.4 in /usr/local/lib/python3.10/dist-packages (from pandas>=0.15.2->datacache<2.0.0,>=1.4.0->pyensembl) (1.26.4)\n","Requirement already satisfied: python-dateutil>=2.8.2 in /usr/local/lib/python3.10/dist-packages (from pandas>=0.15.2->datacache<2.0.0,>=1.4.0->pyensembl) (2.8.2)\n","Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas>=0.15.2->datacache<2.0.0,>=1.4.0->pyensembl) (2024.1)\n","Requirement already satisfied: tzdata>=2022.1 in /usr/local/lib/python3.10/dist-packages (from pandas>=0.15.2->datacache<2.0.0,>=1.4.0->pyensembl) (2024.1)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests>=2.5.1->datacache<2.0.0,>=1.4.0->pyensembl) (3.3.2)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests>=2.5.1->datacache<2.0.0,>=1.4.0->pyensembl) (3.8)\n","Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests>=2.5.1->datacache<2.0.0,>=1.4.0->pyensembl) (2.0.7)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests>=2.5.1->datacache<2.0.0,>=1.4.0->pyensembl) (2024.8.30)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.10/dist-packages (from python-dateutil>=2.8.2->pandas>=0.15.2->datacache<2.0.0,>=1.4.0->pyensembl) (1.16.0)\n","Downloading pyensembl-2.3.13-py3-none-any.whl (55 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m56.0/56.0 kB\u001b[0m \u001b[31m3.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading datacache-1.4.1-py3-none-any.whl (20 kB)\n","Downloading gtfparse-2.5.0-py3-none-any.whl (15 kB)\n","Downloading pylint-2.17.7-py3-none-any.whl (537 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m537.2/537.2 kB\u001b[0m \u001b[31m26.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading serializable-0.4.1-py3-none-any.whl (12 kB)\n","Downloading appdirs-1.4.4-py2.py3-none-any.whl (9.6 kB)\n","Downloading astroid-2.15.8-py3-none-any.whl (278 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m278.3/278.3 kB\u001b[0m \u001b[31m16.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading dill-0.3.8-py3-none-any.whl (116 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m116.3/116.3 kB\u001b[0m \u001b[31m8.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading isort-5.13.2-py3-none-any.whl (92 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m92.3/92.3 kB\u001b[0m \u001b[31m6.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading mccabe-0.7.0-py2.py3-none-any.whl (7.3 kB)\n","Downloading mock-5.1.0-py3-none-any.whl (30 kB)\n","Downloading simplejson-3.19.3-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (137 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m137.9/137.9 kB\u001b[0m \u001b[31m9.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading lazy_object_proxy-1.10.0-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (68 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m68.3/68.3 kB\u001b[0m \u001b[31m4.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hBuilding wheels for collected packages: memoized-property, tinytimer, typechecks, progressbar33\n","  Building wheel for memoized-property (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for memoized-property: filename=memoized_property-1.0.3-py2.py3-none-any.whl size=4185 sha256=51e9f99a8692cac13119d4336bdc943645197ad0589086909f4b956380ea5f5a\n","  Stored in directory: /root/.cache/pip/wheels/f7/0f/93/d0497c1248dcc9113cfa09e6ddf52f5636b68bcd6751bad581\n","  Building wheel for tinytimer (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for tinytimer: filename=tinytimer-0.0.0-py3-none-any.whl size=1874 sha256=65061c7692bb7ace355d45c53db9bb7af5fc879a4058789ac5ea5d296fa3c155\n","  Stored in directory: /root/.cache/pip/wheels/35/7f/a3/036dd96fcd3da5d509047bcc764790cea8f6c73edadb1cbedc\n","  Building wheel for typechecks (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for typechecks: filename=typechecks-0.1.0-py3-none-any.whl size=2752 sha256=d9f73247031688571f39f50fa387266445465dc165cabb236b56bd4b12f5cb73\n","  Stored in directory: /root/.cache/pip/wheels/da/a7/4d/6fb19c879271cf359a24d5bc4d074d53380cc2473f70068c4e\n","  Building wheel for progressbar33 (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for progressbar33: filename=progressbar33-2.4-py3-none-any.whl size=12142 sha256=578c3cbae94a8152d3d276b9cc2ae8784848c5c904d3a09e9310467193104724\n","  Stored in directory: /root/.cache/pip/wheels/28/6d/b6/fd4b9b1489353528a2eea1200c98532fd60d535e22498d9e28\n","Successfully built memoized-property tinytimer typechecks progressbar33\n","Installing collected packages: typechecks, tinytimer, progressbar33, memoized-property, appdirs, simplejson, mock, mccabe, lazy-object-proxy, isort, dill, serializable, gtfparse, astroid, pylint, datacache, pyensembl\n","Successfully installed appdirs-1.4.4 astroid-2.15.8 datacache-1.4.1 dill-0.3.8 gtfparse-2.5.0 isort-5.13.2 lazy-object-proxy-1.10.0 mccabe-0.7.0 memoized-property-1.0.3 mock-5.1.0 progressbar33-2.4 pyensembl-2.3.13 pylint-2.17.7 serializable-0.4.1 simplejson-3.19.3 tinytimer-0.0.0 typechecks-0.1.0\n"]}],"source":["!pip install pyensembl"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"B1vO0qhc9a7y"},"outputs":[],"source":["from pyensembl import EnsemblRelease\n","data = EnsemblRelease(77)\n","data.download()\n","data.index()\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1003,"status":"ok","timestamp":1726157351054,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"9by85xY49hlF","outputId":"1d787bb9-522d-4951-8e9d-2aeaa0fb9515"},"outputs":[{"name":"stdout","output_type":"stream","text":["                  gene_ids-0\n","MIR1302-2HG             None\n","FAM138A      ENSG00000237613\n","OR4F5        ENSG00000186092\n","AL627309.1              None\n","AL627309.3              None\n","                  gene_ids-0\n","MIR1302-2HG             None\n","FAM138A      ENSG00000237613\n","OR4F5        ENSG00000186092\n","AL627309.1              None\n","AL627309.3              None\n"]}],"source":["from pyensembl import EnsemblRelease\n","ensembl_data = EnsemblRelease(77)\n","def get_ensembl_id(gene_name):\n","    try:\n","        gene_ids = ensembl_data.gene_ids_of_gene_name(gene_name)\n","        return gene_ids[0] if gene_ids else None\n","    except:\n","        return None\n","\n","for adata in [adata_7147764, adata_7837923]:\n","    adata.var['gene_ids-0'] = adata.var.index.map(get_ensembl_id)\n","\n","print(adata_7147764.var[['gene_ids-0']].head())\n","print(adata_7837923.var[['gene_ids-0']].head())\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4,"status":"ok","timestamp":1726157351054,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"95sBqVFU_B4z","outputId":"d49e98f0-d098-473d-8c6d-922357f804c4"},"outputs":[{"data":{"text/plain":["AnnData object with n_obs × n_vars = 7708 × 36601\n","    obs: 'celltype'\n","    var: 'gene_ids-0'"]},"execution_count":53,"metadata":{},"output_type":"execute_result"}],"source":["adata_7147764"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"HkPGOuKV_fZU"},"outputs":[],"source":["new_index = [item[0] for item in adata_7147764.obs.index]\n","new_index = [item.split('-')[0] for item in new_index]\n","adata_7147764.obs.index = new_index"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Gs8U9IiNAXzv"},"outputs":[],"source":["new_index = [item[0] for item in adata_7837923.obs.index]\n","new_index = [item.split('-')[0] for item in new_index]\n","adata_7837923.obs.index = new_index"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":423},"executionInfo":{"elapsed":233,"status":"ok","timestamp":1726157554100,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"cpyTTJuQ_TVc","outputId":"bfd9ef9b-c6e9-4219-9a2c-4ecae1a3163a"},"outputs":[{"data":{"application/vnd.google.colaboratory.intrinsic+json":{"summary":"{\n  \"name\": \"adata_7837923\",\n  \"rows\": 15909,\n  \"fields\": [\n    {\n      \"column\": \"celltype\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          \"ipsc\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}","type":"dataframe"},"text/html":["\n","  <div id=\"df-c31eeaac-89dd-4def-8ad9-b113bf0c32c2\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>celltype</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>AAACCCAAGCATACTC</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>AAACCCAAGGCCACTC</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>AAACCCAAGGCTTTCA</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>AAACCCAAGGTCATCT</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>AAACCCACAAGGCCTC</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>TTTGTTGGTCTCAGAT</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>TTTGTTGGTGTAACGG</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>TTTGTTGGTTGGATCT</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>TTTGTTGTCACCGGGT</th>\n","      <td>ipsc</td>\n","    </tr>\n","    <tr>\n","      <th>TTTGTTGTCAGATGCT</th>\n","      <td>ipsc</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>15909 rows × 1 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-c31eeaac-89dd-4def-8ad9-b113bf0c32c2')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-c31eeaac-89dd-4def-8ad9-b113bf0c32c2 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-c31eeaac-89dd-4def-8ad9-b113bf0c32c2');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-fa7b49be-40f5-4366-902d-d3aa41b9f51f\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-fa7b49be-40f5-4366-902d-d3aa41b9f51f')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-fa7b49be-40f5-4366-902d-d3aa41b9f51f button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","\n","    </div>\n","  </div>\n"],"text/plain":["                 celltype\n","AAACCCAAGCATACTC     ipsc\n","AAACCCAAGGCCACTC     ipsc\n","AAACCCAAGGCTTTCA     ipsc\n","AAACCCAAGGTCATCT     ipsc\n","AAACCCACAAGGCCTC     ipsc\n","...                   ...\n","TTTGTTGGTCTCAGAT     ipsc\n","TTTGTTGGTGTAACGG     ipsc\n","TTTGTTGGTTGGATCT     ipsc\n","TTTGTTGTCACCGGGT     ipsc\n","TTTGTTGTCAGATGCT     ipsc\n","\n","[15909 rows x 1 columns]"]},"execution_count":62,"metadata":{},"output_type":"execute_result"}],"source":["adata_7837923.obs"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":19599,"status":"ok","timestamp":1726157617417,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"AcVzq6w0AqhI","outputId":"ec412f09-9f07-4f1a-c68e-08cf5b6f5e45"},"outputs":[{"name":"stdout","output_type":"stream","text":["Saved adata_1.h5ad\n","Saved adata_2.h5ad\n"]}],"source":["for idx, adata in enumerate([adata_7147764, adata_7837923], 1):\n","    filename = f\"adata_{idx}.h5ad\"\n","    adata.write_h5ad(filename)\n","    print(f\"Saved {filename}\")"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2076,"status":"ok","timestamp":1726157648105,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"j_DBlrN4Ay1J","outputId":"9157ff5d-d3b9-4266-e82c-ee3f4859fd9f"},"outputs":[{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/anndata.py:1756: UserWarning: Variable names are not unique. To make them unique, call `.var_names_make_unique`.\n","  utils.warn_names_duplicates(\"var\")\n"]}],"source":["test_adata = sc.read_h5ad(\"adata_1.h5ad\")"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":115},"executionInfo":{"elapsed":207,"status":"ok","timestamp":1726157677409,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"HUQD3UGjA3-F","outputId":"73500916-2e55-4458-c4f5-05c8132dfccb"},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>0</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>gene_ids-0</th>\n","      <td>14101</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div><br><label><b>dtype:</b> int64</label>"],"text/plain":["gene_ids-0    14101\n","dtype: int64"]},"execution_count":67,"metadata":{},"output_type":"execute_result"}],"source":["test_adata.var.isna().sum()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":423},"executionInfo":{"elapsed":201,"status":"ok","timestamp":1726157689231,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"ut02L2G6A_ri","outputId":"9b1df1a3-5bfe-4159-bd71-23bffb21b54e"},"outputs":[{"data":{"application/vnd.google.colaboratory.intrinsic+json":{"summary":"{\n  \"name\": \"test_adata\",\n  \"rows\": 36601,\n  \"fields\": [\n    {\n      \"column\": \"gene_ids-0\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 22492,\n        \"samples\": [\n          \"ENSG00000161091\",\n          \"ENSG00000105697\",\n          \"ENSG00000204704\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}","type":"dataframe"},"text/html":["\n","  <div id=\"df-a102c2f5-5132-43b7-9509-7828d5ed502c\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>gene_ids-0</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>MIR1302-2HG</th>\n","      <td>NaN</td>\n","    </tr>\n","    <tr>\n","      <th>FAM138A</th>\n","      <td>ENSG00000237613</td>\n","    </tr>\n","    <tr>\n","      <th>OR4F5</th>\n","      <td>ENSG00000186092</td>\n","    </tr>\n","    <tr>\n","      <th>AL627309.1</th>\n","      <td>NaN</td>\n","    </tr>\n","    <tr>\n","      <th>AL627309.3</th>\n","      <td>NaN</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>AC141272.1</th>\n","      <td>ENSG00000277836</td>\n","    </tr>\n","    <tr>\n","      <th>AC023491.2</th>\n","      <td>ENSG00000278633</td>\n","    </tr>\n","    <tr>\n","      <th>AC007325.1</th>\n","      <td>ENSG00000276017</td>\n","    </tr>\n","    <tr>\n","      <th>AC007325.4</th>\n","      <td>NaN</td>\n","    </tr>\n","    <tr>\n","      <th>AC007325.2</th>\n","      <td>ENSG00000278573</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>36601 rows × 1 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-a102c2f5-5132-43b7-9509-7828d5ed502c')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-a102c2f5-5132-43b7-9509-7828d5ed502c button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-a102c2f5-5132-43b7-9509-7828d5ed502c');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-cb237f94-c47f-47ad-99bc-17a8dcfcd22d\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-cb237f94-c47f-47ad-99bc-17a8dcfcd22d')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-cb237f94-c47f-47ad-99bc-17a8dcfcd22d button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","\n","    </div>\n","  </div>\n"],"text/plain":["                  gene_ids-0\n","MIR1302-2HG              NaN\n","FAM138A      ENSG00000237613\n","OR4F5        ENSG00000186092\n","AL627309.1               NaN\n","AL627309.3               NaN\n","...                      ...\n","AC141272.1   ENSG00000277836\n","AC023491.2   ENSG00000278633\n","AC007325.1   ENSG00000276017\n","AC007325.4               NaN\n","AC007325.2   ENSG00000278573\n","\n","[36601 rows x 1 columns]"]},"execution_count":68,"metadata":{},"output_type":"execute_result"}],"source":["test_adata.var"]},{"cell_type":"markdown","metadata":{"id":"XX-74OlxQPE3"},"source":["## gene subsetting"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"JSwi2lB5DbFD"},"outputs":[],"source":["import os"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"bkyAC6oEDXlo"},"outputs":[],"source":["os.chdir('/content/drive/MyDrive/Programmable Biology Group/Srikar/tf-flow-design/gonadal/data')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"H-nyQWUJDcC_"},"outputs":[],"source":["ipsc1 = sc.read_h5ad(\"adata_1.h5ad\")\n","ipsc2 = sc.read_h5ad(\"adata_2.h5ad\")\n","gonad = sc.read_h5ad(\"human_germcells.h5ad\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"oddh_53JF_u5"},"outputs":[],"source":["gonad"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"3Oe9pnJoGcUU"},"outputs":[],"source":["import scanpy as sc\n","import pandas as pd\n","\n","# Get unique cell types\n","cell_types = gonad.obs['celltype'].unique()\n","\n","# Split and save gonad data by cell type\n","gonad_datasets = {}\n","for ct in cell_types:\n","    gonad_subset = gonad[gonad.obs['celltype'] == ct].copy()\n","    filename = f\"gonad_{ct.replace(' ', '_')}.h5ad\"\n","    gonad_subset.write_h5ad(filename)\n","    gonad_datasets[ct] = gonad_subset\n","    print(f\"Saved {filename}\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"UZxvNq80Mfas"},"outputs":[],"source":["import os\n","os.chdir('/content/drive/MyDrive/Programmable Biology Group/Srikar/tf-flow-design/gonadal/data')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":5962,"status":"ok","timestamp":1726160737575,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"PNku6lycMexS","outputId":"561c6768-ad00-44f9-c53c-34f13c007f6f"},"outputs":[{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/anndata.py:1756: UserWarning: Variable names are not unique. To make them unique, call `.var_names_make_unique`.\n","  utils.warn_names_duplicates(\"var\")\n"]}],"source":["ipsc1 = sc.read_h5ad(\"adata_1.h5ad\")\n","ipsc2 = sc.read_h5ad(\"adata_2.h5ad\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Uz54KYFbMsbR"},"outputs":[],"source":["gonad = sc.read_h5ad(\"human_germcells.h5ad\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ZUEeUNaFHRDj"},"outputs":[],"source":["gonad_genes = gonad.var.index.tolist()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"B-p6uAlyHUym"},"outputs":[],"source":["# gonad_genes"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"m7vD-PUGHWAh"},"outputs":[],"source":["ipsc1_genes = ipsc1.var.index.to_list()\n","ipsc2_genes = ipsc2.var.index.to_list()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":5,"status":"ok","timestamp":1726160788299,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"404VVJAyIu1W","outputId":"c5d84de1-e264-4965-f2a0-92d0bbe8477d"},"outputs":[{"name":"stdout","output_type":"stream","text":["Number of overlapping genes between iPSC1 and gonad: 27577\n","Proportion of overlap in iPSC1: 0.75\n","Number of overlapping genes between iPSC2 and gonad: 27577\n","Proportion of overlap in iPSC2: 0.75\n"]}],"source":["# Convert gene lists to sets\n","gonad_genes_set = set(gonad_genes)\n","ipsc1_genes_set = set(ipsc1_genes)\n","ipsc2_genes_set = set(ipsc2_genes)\n","\n","# Calculate overlaps\n","overlap_ipsc1_gonad = ipsc1_genes_set.intersection(gonad_genes_set)\n","overlap_ipsc2_gonad = ipsc2_genes_set.intersection(gonad_genes_set)\n","\n","# Calculate proportions\n","proportion_ipsc1_overlap = len(overlap_ipsc1_gonad) / len(ipsc1_genes_set)\n","proportion_ipsc2_overlap = len(overlap_ipsc2_gonad) / len(ipsc2_genes_set)\n","\n","# Print results\n","print(f\"Number of overlapping genes between iPSC1 and gonad: {len(overlap_ipsc1_gonad)}\")\n","print(f\"Proportion of overlap in iPSC1: {proportion_ipsc1_overlap:.2f}\")\n","print(f\"Number of overlapping genes between iPSC2 and gonad: {len(overlap_ipsc2_gonad)}\")\n","print(f\"Proportion of overlap in iPSC2: {proportion_ipsc2_overlap:.2f}\")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":230,"status":"ok","timestamp":1726160788526,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"Fy9I5itXJTDT","outputId":"ee6ab51a-1e1f-43d2-8957-6f6e3d213e42"},"outputs":[{"data":{"text/plain":["28820"]},"execution_count":19,"metadata":{},"output_type":"execute_result"}],"source":["len(gonad_genes)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"iD3nLUPiIu37"},"outputs":[],"source":["import scanpy as sc\n","\n","# Define the list of gonad genes\n","gonad_genes = set(gonad.var.index.tolist())  # Ensure gonad_genes is a set for fast lookups\n","\n","# Subset ipsc1 and ipsc2 to gonad_genes\n","ipsc1 = ipsc1[:, ipsc1.var.index.isin(gonad_genes)]\n","ipsc2 = ipsc2[:, ipsc2.var.index.isin(gonad_genes)]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"eGb5HntyIu6y"},"outputs":[],"source":["# Get genes in ipsc1 and ipsc2\n","ipsc1_genes = set(ipsc1.var.index.tolist())\n","ipsc2_genes = set(ipsc2.var.index.tolist())\n","\n","# Find the intersection of all gene sets\n","common_genes = gonad_genes.intersection(ipsc1_genes).intersection(ipsc2_genes)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"N7Ip2alFIu9q"},"outputs":[],"source":["# Subset gonad dataset\n","gonad = gonad[:, gonad.var.index.isin(common_genes)]\n","\n","# Subset ipsc1 dataset\n","ipsc1 = ipsc1[:, ipsc1.var.index.isin(common_genes)]\n","\n","# Subset ipsc2 dataset\n","ipsc2 = ipsc2[:, ipsc2.var.index.isin(common_genes)]\n","\n","# save the filtered ipsc1 and ipsc2 datasets\n","ipsc1.write(\"filtered_ipsc1_file.h5ad\")\n","ipsc2.write(\"filtered_ipsc2_file.h5ad\")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":343,"status":"ok","timestamp":1726160921835,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"PA_JpbipNVrV","outputId":"0859017c-86ce-4094-89a5-abba3f8dfe83"},"outputs":[{"name":"stdout","output_type":"stream","text":["Processing ipsc1...\n","Number of duplicate gene names: 9\n","Processing ipsc2...\n"]}],"source":["import pandas as pd\n","\n","# Function to find and remove duplicate gene names\n","def remove_duplicates(adata):\n","    # Find duplicate gene names\n","    duplicates = adata.var.index[adata.var.index.duplicated()].tolist()\n","\n","    if duplicates:\n","        print(f\"Number of duplicate gene names: {len(duplicates)}\")\n","\n","        # Keep only the first occurrence of each gene\n","        adata = adata[:, ~adata.var.index.duplicated()]\n","\n","    return adata\n","\n","# Find and remove duplicate genes in ipsc1\n","print(\"Processing ipsc1...\")\n","ipsc1 = remove_duplicates(ipsc1)\n","\n","# Find and remove duplicate genes in ipsc2\n","print(\"Processing ipsc2...\")\n","ipsc2 = remove_duplicates(ipsc2)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"uVPxeuOUNYrQ"},"outputs":[],"source":["# save the filtered ipsc1 and ipsc2 datasets\n","ipsc1.write(\"filtered_ipsc1_file.h5ad\")\n","ipsc2.write(\"filtered_ipsc2_file.h5ad\")"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":5,"status":"ok","timestamp":1726160960170,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"eqGA1fnZNGC2","outputId":"ad3b4a7d-337f-4eca-ae20-f67ba5a4fe4c"},"outputs":[{"data":{"text/plain":["(27577, 1)"]},"execution_count":32,"metadata":{},"output_type":"execute_result"}],"source":["ipsc1.var.shape"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":3,"status":"ok","timestamp":1726160960170,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"ZsN9F2yYNHtl","outputId":"2894b7ea-5c3c-4abe-a7f9-ae5f09d97359"},"outputs":[{"data":{"text/plain":["(27577, 1)"]},"execution_count":33,"metadata":{},"output_type":"execute_result"}],"source":["ipsc2.var.shape"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2,"status":"ok","timestamp":1726160960170,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"LyAPD60IM7kR","outputId":"7d69b831-7e3b-4dd5-8968-bbac0050f98b"},"outputs":[{"data":{"text/plain":["27577"]},"execution_count":34,"metadata":{},"output_type":"execute_result"}],"source":["len(common_genes)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"q52y7VfCIvAy"},"outputs":[],"source":["# Subset other gonad-related datasets\n","files = [\n","    \"gonad_PGC.h5ad\",\n","    \"gonad_oogonia_STRA8.h5ad\",\n","    \"gonad_GC.h5ad\",\n","    \"gonad_oocyte.h5ad\",\n","    \"gonad_pre_oocyte.h5ad\",\n","    \"gonad_GC_mitotic.h5ad\",\n","    \"gonad_oogonia_meiotic.h5ad\",\n","    \"gonad_pre_spermatogonia.h5ad\"\n","]\n","\n","# Read in and subset each file\n","datasets = {}\n","for file in files:\n","    adata = sc.read(file)\n","    adata = adata[:, adata.var.index.isin(common_genes)]\n","    datasets[file] = adata\n","\n","# Save the subsetted datasets if needed\n","for file, adata in datasets.items():\n","    adata = remove_duplicates(adata)\n","    adata.write(file.replace(\".h5ad\", \"_filtered.h5ad\"))"]},{"cell_type":"markdown","metadata":{"id":"xIDBxfTUDToQ"},"source":["## c1_c2 pairs"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"PiN6ORIJQibt"},"outputs":[],"source":["import os\n","os.chdir('/content/drive/MyDrive/Programmable Biology Group/Srikar/tf-flow-design/gonadal/data')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"E3cGP4nGGe8B"},"outputs":[],"source":["import scanpy as sc\n","import anndata as ad\n","\n","def concatenate_and_save(adata1, adata2, name1, name2):\n","    # Add a column to distinguish the datasets\n","    adata1.obs['dataset'] = name1\n","    adata2.obs['dataset'] = name2\n","\n","    # Concatenate\n","    combined = ad.concat([adata1, adata2], axis=0, join='outer')\n","\n","    # Save the combined dataset\n","    filename = f\"{name1}_vs_{name2}.h5ad\"\n","    combined.write_h5ad(filename)\n","    print(f\"Saved {filename}\")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"XdYEr-KmR2iz"},"outputs":[],"source":["# Load filtered datasets\n","ipsc1 = sc.read(\"filtered_ipsc1_file.h5ad\")\n","ipsc2 = sc.read(\"filtered_ipsc2_file.h5ad\")\n","\n","# Dictionary for filtered gonad datasets\n","gonad_datasets = {}\n","files = [\n","    \"gonad_PGC.h5ad\",\n","    \"gonad_oogoniaSTRA8.h5ad\",\n","    \"gonad_GC.h5ad\",\n","    \"gonad_oocyte.h5ad\",\n","    \"gonad_preoocyte.h5ad\",\n","    \"gonad_GCmitotic.h5ad\",\n","    \"gonad_oogoniameiotic.h5ad\",\n","    \"gonad_prespermatogonia.h5ad\"\n","]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"BF9dKZPbRB7U"},"outputs":[],"source":["# Load and filter gonad datasets\n","for file in files:\n","    filtered_file = file.replace(\".h5ad\", \"_filtered.h5ad\")\n","    adata = sc.read(filtered_file)\n","    gonad_type = file.split('_')[1]  # Extract the type from filename (assuming format \"gonad_<type>.h5ad\")\n","    gonad_datasets[gonad_type] = adata\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":5813,"status":"ok","timestamp":1726168562096,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"xdIusUhySiOF","outputId":"93e32feb-c78d-4795-de71-00fd6372d0da"},"outputs":[{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/anndata.py:1754: UserWarning: Observation names are not unique. To make them unique, call `.obs_names_make_unique`.\n","  utils.warn_names_duplicates(\"obs\")\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc1_vs_ipsc2.h5ad\n"]}],"source":["# Concatenate ipsc1 and ipsc2\n","concatenate_and_save(ipsc1, ipsc2, \"ipsc1\", \"ipsc2\")"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4867,"status":"ok","timestamp":1726162402143,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"VEHlTY23Sxgv","outputId":"2fd68ca9-c193-4608-d64e-031776a9a0f5"},"outputs":[{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/anndata.py:1754: UserWarning: Observation names are not unique. To make them unique, call `.obs_names_make_unique`.\n","  utils.warn_names_duplicates(\"obs\")\n"]}],"source":["# test = sc.read_h5ad(\"ipsc1_vs_ipsc2.h5ad\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"f8C6dTOaS-qq"},"outputs":[],"source":["# test.obs"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":95442,"status":"ok","timestamp":1726168657524,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"C62092iuRD9y","outputId":"7700a1c3-47ed-4397-815f-ef431c3e0111"},"outputs":[{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc1_vs_gonad_PGC.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc1_vs_gonad_oogoniaSTRA8.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc1_vs_gonad_GC.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc1_vs_gonad_oocyte.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc1_vs_gonad_preoocyte.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc1_vs_gonad_GCmitotic.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc1_vs_gonad_oogoniameiotic.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc1_vs_gonad_prespermatogonia.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc2_vs_gonad_PGC.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc2_vs_gonad_oogoniaSTRA8.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc2_vs_gonad_GC.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc2_vs_gonad_oocyte.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc2_vs_gonad_preoocyte.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc2_vs_gonad_GCmitotic.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc2_vs_gonad_oogoniameiotic.h5ad.h5ad\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/merge.py:1358: UserWarning: Only some AnnData objects have `.raw` attribute, not concatenating `.raw` attributes.\n","  warn(\n"]},{"name":"stdout","output_type":"stream","text":["Saved ipsc2_vs_gonad_prespermatogonia.h5ad.h5ad\n"]}],"source":["\n","# Concatenate ipsc1 with each filtered gonad cell type\n","for ct, gonad_subset in gonad_datasets.items():\n","    concatenate_and_save(ipsc1, gonad_subset, \"ipsc1\", f\"gonad_{ct}\")\n","\n","# Concatenate ipsc2 with each filtered gonad cell type\n","for ct, gonad_subset in gonad_datasets.items():\n","    concatenate_and_save(ipsc2, gonad_subset, \"ipsc2\", f\"gonad_{ct}\")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"collapsed":true,"executionInfo":{"elapsed":49033,"status":"ok","timestamp":1726168706543,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"I9Q_qye-Yk0q","outputId":"bca5ba05-4638-4802-865c-22ed216abf5b"},"outputs":[{"name":"stdout","output_type":"stream","text":["Saved gonad_PGC.h5ad_vs_gonad_oogoniaSTRA8.h5ad.h5ad\n","Saved gonad_PGC.h5ad_vs_gonad_GC.h5ad.h5ad\n","Saved gonad_PGC.h5ad_vs_gonad_oocyte.h5ad.h5ad\n","Saved gonad_PGC.h5ad_vs_gonad_preoocyte.h5ad.h5ad\n","Saved gonad_PGC.h5ad_vs_gonad_GCmitotic.h5ad.h5ad\n","Saved gonad_PGC.h5ad_vs_gonad_oogoniameiotic.h5ad.h5ad\n","Saved gonad_PGC.h5ad_vs_gonad_prespermatogonia.h5ad.h5ad\n","Saved gonad_oogoniaSTRA8.h5ad_vs_gonad_GC.h5ad.h5ad\n","Saved gonad_oogoniaSTRA8.h5ad_vs_gonad_oocyte.h5ad.h5ad\n","Saved gonad_oogoniaSTRA8.h5ad_vs_gonad_preoocyte.h5ad.h5ad\n","Saved gonad_oogoniaSTRA8.h5ad_vs_gonad_GCmitotic.h5ad.h5ad\n","Saved gonad_oogoniaSTRA8.h5ad_vs_gonad_oogoniameiotic.h5ad.h5ad\n","Saved gonad_oogoniaSTRA8.h5ad_vs_gonad_prespermatogonia.h5ad.h5ad\n","Saved gonad_GC.h5ad_vs_gonad_oocyte.h5ad.h5ad\n","Saved gonad_GC.h5ad_vs_gonad_preoocyte.h5ad.h5ad\n","Saved gonad_GC.h5ad_vs_gonad_GCmitotic.h5ad.h5ad\n","Saved gonad_GC.h5ad_vs_gonad_oogoniameiotic.h5ad.h5ad\n","Saved gonad_GC.h5ad_vs_gonad_prespermatogonia.h5ad.h5ad\n","Saved gonad_oocyte.h5ad_vs_gonad_preoocyte.h5ad.h5ad\n","Saved gonad_oocyte.h5ad_vs_gonad_GCmitotic.h5ad.h5ad\n","Saved gonad_oocyte.h5ad_vs_gonad_oogoniameiotic.h5ad.h5ad\n","Saved gonad_oocyte.h5ad_vs_gonad_prespermatogonia.h5ad.h5ad\n","Saved gonad_preoocyte.h5ad_vs_gonad_GCmitotic.h5ad.h5ad\n","Saved gonad_preoocyte.h5ad_vs_gonad_oogoniameiotic.h5ad.h5ad\n","Saved gonad_preoocyte.h5ad_vs_gonad_prespermatogonia.h5ad.h5ad\n","Saved gonad_GCmitotic.h5ad_vs_gonad_oogoniameiotic.h5ad.h5ad\n","Saved gonad_GCmitotic.h5ad_vs_gonad_prespermatogonia.h5ad.h5ad\n","Saved gonad_oogoniameiotic.h5ad_vs_gonad_prespermatogonia.h5ad.h5ad\n"]}],"source":["# Concatenate each filtered gonad cell type with each other\n","gonad_types = list(gonad_datasets.keys())\n","for i, ct1 in enumerate(gonad_types):\n","    for ct2 in gonad_types[i+1:]:\n","        gonad_subset1 = gonad_datasets[ct1]\n","        gonad_subset2 = gonad_datasets[ct2]\n","        concatenate_and_save(gonad_subset1, gonad_subset2, f\"gonad_{ct1}\", f\"gonad_{ct2}\")\n","\n"]},{"cell_type":"markdown","metadata":{"id":"dVPLafaG6iwh"},"source":["## bbknn integration"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ZjijglN4Xj4K"},"outputs":[],"source":["# check how many files with \"vs\""]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":327,"status":"ok","timestamp":1726168714145,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"q60yRmvYX9VD","outputId":"62d7891d-9e5d-4f7e-d6b8-357f85325fe5"},"outputs":[{"name":"stdout","output_type":"stream","text":["Number of files with 'vs' in the name: 45\n"]}],"source":["files = os.listdir('.')\n","vs_files = [file for file in files if 'vs' in file]\n","print(f\"Number of files with 'vs' in the namef: {len(vs_files)}\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"5A6hPnIaz-vr"},"outputs":[],"source":["test = sc.read_h5ad('gonad_preoocyte.h5ad_vs_gonad_oogoniameiotic.h5ad.h5ad')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":443},"executionInfo":{"elapsed":141,"status":"ok","timestamp":1726171183123,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"0sgWzCK00GYO","outputId":"9ff00314-990c-4a18-b4fa-a24374208927"},"outputs":[{"data":{"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe"},"text/html":["\n","  <div id=\"df-65df3aeb-b52e-4041-bc5d-18bb9c07e6de\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>n_genes</th>\n","      <th>sample</th>\n","      <th>donor</th>\n","      <th>location</th>\n","      <th>sex</th>\n","      <th>enrichment</th>\n","      <th>cryopreserved</th>\n","      <th>TP</th>\n","      <th>10xKit</th>\n","      <th>dig_protocol</th>\n","      <th>...</th>\n","      <th>zscore</th>\n","      <th>bh_pval</th>\n","      <th>bonf_pval</th>\n","      <th>is_doublet</th>\n","      <th>PCW</th>\n","      <th>sample_source</th>\n","      <th>trimester</th>\n","      <th>celltype</th>\n","      <th>lineage</th>\n","      <th>dataset</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>FCA_GND8103050_AACCGCGGTCATACTG</th>\n","      <td>2259</td>\n","      <td>FCA_GND8103050</td>\n","      <td>F83</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>CD45-</td>\n","      <td>No</td>\n","      <td>U</td>\n","      <td>5v1.1</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>1.974233</td>\n","      <td>0.307983</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>17.0</td>\n","      <td>N</td>\n","      <td>2nd</td>\n","      <td>pre_oocyte</td>\n","      <td>GermCells</td>\n","      <td>gonad_preoocyte.h5ad</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND8103050_AGGCCACAGAGGTAGA</th>\n","      <td>3757</td>\n","      <td>FCA_GND8103050</td>\n","      <td>F83</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>CD45-</td>\n","      <td>No</td>\n","      <td>U</td>\n","      <td>5v1.1</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>1.701070</td>\n","      <td>0.414516</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>17.0</td>\n","      <td>N</td>\n","      <td>2nd</td>\n","      <td>pre_oocyte</td>\n","      <td>GermCells</td>\n","      <td>gonad_preoocyte.h5ad</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND8103050_AGTGTCAGTAGCACGA</th>\n","      <td>1101</td>\n","      <td>FCA_GND8103050</td>\n","      <td>F83</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>CD45-</td>\n","      <td>No</td>\n","      <td>U</td>\n","      <td>5v1.1</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>1.974233</td>\n","      <td>0.307983</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>17.0</td>\n","      <td>N</td>\n","      <td>2nd</td>\n","      <td>pre_oocyte</td>\n","      <td>GermCells</td>\n","      <td>gonad_preoocyte.h5ad</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND8103050_CATATGGGTTGACGTT</th>\n","      <td>749</td>\n","      <td>FCA_GND8103050</td>\n","      <td>F83</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>CD45-</td>\n","      <td>No</td>\n","      <td>U</td>\n","      <td>5v1.1</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>1.879896</td>\n","      <td>0.307983</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>17.0</td>\n","      <td>N</td>\n","      <td>2nd</td>\n","      <td>pre_oocyte</td>\n","      <td>GermCells</td>\n","      <td>gonad_preoocyte.h5ad</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND8103050_CCGGTAGGTCCAACTA</th>\n","      <td>1116</td>\n","      <td>FCA_GND8103050</td>\n","      <td>F83</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>CD45-</td>\n","      <td>No</td>\n","      <td>U</td>\n","      <td>5v1.1</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>1.879896</td>\n","      <td>0.307983</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>17.0</td>\n","      <td>N</td>\n","      <td>2nd</td>\n","      <td>pre_oocyte</td>\n","      <td>GermCells</td>\n","      <td>gonad_preoocyte.h5ad</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND10375780_TGTGGTAAGGCATGTG</th>\n","      <td>1401</td>\n","      <td>FCA_GND10375780</td>\n","      <td>Hrv86</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>total</td>\n","      <td>No</td>\n","      <td>Sur</td>\n","      <td>5DUAL</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>-0.663786</td>\n","      <td>0.828741</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>16.0</td>\n","      <td>L</td>\n","      <td>2nd</td>\n","      <td>oogonia_meiotic</td>\n","      <td>GermCells</td>\n","      <td>gonad_oogoniameiotic.h5ad</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND10375780_TTGCGTCCATCACCCT</th>\n","      <td>1190</td>\n","      <td>FCA_GND10375780</td>\n","      <td>Hrv86</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>total</td>\n","      <td>No</td>\n","      <td>Sur</td>\n","      <td>5DUAL</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>-0.604058</td>\n","      <td>0.822735</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>16.0</td>\n","      <td>L</td>\n","      <td>2nd</td>\n","      <td>oogonia_meiotic</td>\n","      <td>GermCells</td>\n","      <td>gonad_oogoniameiotic.h5ad</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND10375780_TTTACTGGTCGCTTTC</th>\n","      <td>1285</td>\n","      <td>FCA_GND10375780</td>\n","      <td>Hrv86</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>total</td>\n","      <td>No</td>\n","      <td>Sur</td>\n","      <td>5DUAL</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>-0.432602</td>\n","      <td>0.792093</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>16.0</td>\n","      <td>L</td>\n","      <td>2nd</td>\n","      <td>oogonia_meiotic</td>\n","      <td>GermCells</td>\n","      <td>gonad_oogoniameiotic.h5ad</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND10375780_TTTGCGCCATGCAATC</th>\n","      <td>535</td>\n","      <td>FCA_GND10375780</td>\n","      <td>Hrv86</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>total</td>\n","      <td>No</td>\n","      <td>Sur</td>\n","      <td>5DUAL</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>-0.604058</td>\n","      <td>0.822735</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>16.0</td>\n","      <td>L</td>\n","      <td>2nd</td>\n","      <td>oogonia_meiotic</td>\n","      <td>GermCells</td>\n","      <td>gonad_oogoniameiotic.h5ad</td>\n","    </tr>\n","    <tr>\n","      <th>FCA_GND10375780_TTTGCGCTCCCATTTA</th>\n","      <td>613</td>\n","      <td>FCA_GND10375780</td>\n","      <td>Hrv86</td>\n","      <td>Gonad_and_extragonadal</td>\n","      <td>female</td>\n","      <td>total</td>\n","      <td>No</td>\n","      <td>Sur</td>\n","      <td>5DUAL</td>\n","      <td>P_tryp</td>\n","      <td>...</td>\n","      <td>-0.604058</td>\n","      <td>0.822735</td>\n","      <td>1.0</td>\n","      <td>False</td>\n","      <td>16.0</td>\n","      <td>L</td>\n","      <td>2nd</td>\n","      <td>oogonia_meiotic</td>\n","      <td>GermCells</td>\n","      <td>gonad_oogoniameiotic.h5ad</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>2687 rows × 30 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-65df3aeb-b52e-4041-bc5d-18bb9c07e6de')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-65df3aeb-b52e-4041-bc5d-18bb9c07e6de button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-65df3aeb-b52e-4041-bc5d-18bb9c07e6de');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-b01dc03f-f978-4974-9760-a9f87f8db01a\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-b01dc03f-f978-4974-9760-a9f87f8db01a')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-b01dc03f-f978-4974-9760-a9f87f8db01a button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","\n","    </div>\n","  </div>\n"],"text/plain":["                                  n_genes           sample  donor  \\\n","FCA_GND8103050_AACCGCGGTCATACTG      2259   FCA_GND8103050    F83   \n","FCA_GND8103050_AGGCCACAGAGGTAGA      3757   FCA_GND8103050    F83   \n","FCA_GND8103050_AGTGTCAGTAGCACGA      1101   FCA_GND8103050    F83   \n","FCA_GND8103050_CATATGGGTTGACGTT       749   FCA_GND8103050    F83   \n","FCA_GND8103050_CCGGTAGGTCCAACTA      1116   FCA_GND8103050    F83   \n","...                                   ...              ...    ...   \n","FCA_GND10375780_TGTGGTAAGGCATGTG     1401  FCA_GND10375780  Hrv86   \n","FCA_GND10375780_TTGCGTCCATCACCCT     1190  FCA_GND10375780  Hrv86   \n","FCA_GND10375780_TTTACTGGTCGCTTTC     1285  FCA_GND10375780  Hrv86   \n","FCA_GND10375780_TTTGCGCCATGCAATC      535  FCA_GND10375780  Hrv86   \n","FCA_GND10375780_TTTGCGCTCCCATTTA      613  FCA_GND10375780  Hrv86   \n","\n","                                                location     sex enrichment  \\\n","FCA_GND8103050_AACCGCGGTCATACTG   Gonad_and_extragonadal  female      CD45-   \n","FCA_GND8103050_AGGCCACAGAGGTAGA   Gonad_and_extragonadal  female      CD45-   \n","FCA_GND8103050_AGTGTCAGTAGCACGA   Gonad_and_extragonadal  female      CD45-   \n","FCA_GND8103050_CATATGGGTTGACGTT   Gonad_and_extragonadal  female      CD45-   \n","FCA_GND8103050_CCGGTAGGTCCAACTA   Gonad_and_extragonadal  female      CD45-   \n","...                                                  ...     ...        ...   \n","FCA_GND10375780_TGTGGTAAGGCATGTG  Gonad_and_extragonadal  female      total   \n","FCA_GND10375780_TTGCGTCCATCACCCT  Gonad_and_extragonadal  female      total   \n","FCA_GND10375780_TTTACTGGTCGCTTTC  Gonad_and_extragonadal  female      total   \n","FCA_GND10375780_TTTGCGCCATGCAATC  Gonad_and_extragonadal  female      total   \n","FCA_GND10375780_TTTGCGCTCCCATTTA  Gonad_and_extragonadal  female      total   \n","\n","                                 cryopreserved   TP 10xKit dig_protocol  ...  \\\n","FCA_GND8103050_AACCGCGGTCATACTG             No    U  5v1.1       P_tryp  ...   \n","FCA_GND8103050_AGGCCACAGAGGTAGA             No    U  5v1.1       P_tryp  ...   \n","FCA_GND8103050_AGTGTCAGTAGCACGA             No    U  5v1.1       P_tryp  ...   \n","FCA_GND8103050_CATATGGGTTGACGTT             No    U  5v1.1       P_tryp  ...   \n","FCA_GND8103050_CCGGTAGGTCCAACTA             No    U  5v1.1       P_tryp  ...   \n","...                                        ...  ...    ...          ...  ...   \n","FCA_GND10375780_TGTGGTAAGGCATGTG            No  Sur  5DUAL       P_tryp  ...   \n","FCA_GND10375780_TTGCGTCCATCACCCT            No  Sur  5DUAL       P_tryp  ...   \n","FCA_GND10375780_TTTACTGGTCGCTTTC            No  Sur  5DUAL       P_tryp  ...   \n","FCA_GND10375780_TTTGCGCCATGCAATC            No  Sur  5DUAL       P_tryp  ...   \n","FCA_GND10375780_TTTGCGCTCCCATTTA            No  Sur  5DUAL       P_tryp  ...   \n","\n","                                    zscore   bh_pval bonf_pval is_doublet  \\\n","FCA_GND8103050_AACCGCGGTCATACTG   1.974233  0.307983       1.0      False   \n","FCA_GND8103050_AGGCCACAGAGGTAGA   1.701070  0.414516       1.0      False   \n","FCA_GND8103050_AGTGTCAGTAGCACGA   1.974233  0.307983       1.0      False   \n","FCA_GND8103050_CATATGGGTTGACGTT   1.879896  0.307983       1.0      False   \n","FCA_GND8103050_CCGGTAGGTCCAACTA   1.879896  0.307983       1.0      False   \n","...                                    ...       ...       ...        ...   \n","FCA_GND10375780_TGTGGTAAGGCATGTG -0.663786  0.828741       1.0      False   \n","FCA_GND10375780_TTGCGTCCATCACCCT -0.604058  0.822735       1.0      False   \n","FCA_GND10375780_TTTACTGGTCGCTTTC -0.432602  0.792093       1.0      False   \n","FCA_GND10375780_TTTGCGCCATGCAATC -0.604058  0.822735       1.0      False   \n","FCA_GND10375780_TTTGCGCTCCCATTTA -0.604058  0.822735       1.0      False   \n","\n","                                   PCW  sample_source  trimester  \\\n","FCA_GND8103050_AACCGCGGTCATACTG   17.0              N        2nd   \n","FCA_GND8103050_AGGCCACAGAGGTAGA   17.0              N        2nd   \n","FCA_GND8103050_AGTGTCAGTAGCACGA   17.0              N        2nd   \n","FCA_GND8103050_CATATGGGTTGACGTT   17.0              N        2nd   \n","FCA_GND8103050_CCGGTAGGTCCAACTA   17.0              N        2nd   \n","...                                ...            ...        ...   \n","FCA_GND10375780_TGTGGTAAGGCATGTG  16.0              L        2nd   \n","FCA_GND10375780_TTGCGTCCATCACCCT  16.0              L        2nd   \n","FCA_GND10375780_TTTACTGGTCGCTTTC  16.0              L        2nd   \n","FCA_GND10375780_TTTGCGCCATGCAATC  16.0              L        2nd   \n","FCA_GND10375780_TTTGCGCTCCCATTTA  16.0              L        2nd   \n","\n","                                         celltype    lineage  \\\n","FCA_GND8103050_AACCGCGGTCATACTG        pre_oocyte  GermCells   \n","FCA_GND8103050_AGGCCACAGAGGTAGA        pre_oocyte  GermCells   \n","FCA_GND8103050_AGTGTCAGTAGCACGA        pre_oocyte  GermCells   \n","FCA_GND8103050_CATATGGGTTGACGTT        pre_oocyte  GermCells   \n","FCA_GND8103050_CCGGTAGGTCCAACTA        pre_oocyte  GermCells   \n","...                                           ...        ...   \n","FCA_GND10375780_TGTGGTAAGGCATGTG  oogonia_meiotic  GermCells   \n","FCA_GND10375780_TTGCGTCCATCACCCT  oogonia_meiotic  GermCells   \n","FCA_GND10375780_TTTACTGGTCGCTTTC  oogonia_meiotic  GermCells   \n","FCA_GND10375780_TTTGCGCCATGCAATC  oogonia_meiotic  GermCells   \n","FCA_GND10375780_TTTGCGCTCCCATTTA  oogonia_meiotic  GermCells   \n","\n","                                                    dataset  \n","FCA_GND8103050_AACCGCGGTCATACTG        gonad_preoocyte.h5ad  \n","FCA_GND8103050_AGGCCACAGAGGTAGA        gonad_preoocyte.h5ad  \n","FCA_GND8103050_AGTGTCAGTAGCACGA        gonad_preoocyte.h5ad  \n","FCA_GND8103050_CATATGGGTTGACGTT        gonad_preoocyte.h5ad  \n","FCA_GND8103050_CCGGTAGGTCCAACTA        gonad_preoocyte.h5ad  \n","...                                                     ...  \n","FCA_GND10375780_TGTGGTAAGGCATGTG  gonad_oogoniameiotic.h5ad  \n","FCA_GND10375780_TTGCGTCCATCACCCT  gonad_oogoniameiotic.h5ad  \n","FCA_GND10375780_TTTACTGGTCGCTTTC  gonad_oogoniameiotic.h5ad  \n","FCA_GND10375780_TTTGCGCCATGCAATC  gonad_oogoniameiotic.h5ad  \n","FCA_GND10375780_TTTGCGCTCCCATTTA  gonad_oogoniameiotic.h5ad  \n","\n","[2687 rows x 30 columns]"]},"execution_count":38,"metadata":{},"output_type":"execute_result"}],"source":["test.obs"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":12829,"status":"ok","timestamp":1726172900687,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"vvXz-sdQ6-L9","outputId":"fba0ea08-2d0d-486b-f2ef-b569541a56c3"},"outputs":[{"name":"stdout","output_type":"stream","text":["Collecting bbknn\n","  Downloading bbknn-1.6.0-py3-none-any.whl.metadata (8.2 kB)\n","Collecting Cython (from bbknn)\n","  Downloading Cython-3.0.11-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.2 kB)\n","Requirement already satisfied: scipy>=1.6.0 in /usr/local/lib/python3.10/dist-packages (from bbknn) (1.13.1)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.10/dist-packages (from bbknn) (1.26.4)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.10/dist-packages (from bbknn) (2.1.4)\n","Collecting annoy (from bbknn)\n","  Downloading annoy-1.17.3.tar.gz (647 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m647.5/647.5 kB\u001b[0m \u001b[31m4.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Requirement already satisfied: pynndescent in /usr/local/lib/python3.10/dist-packages (from bbknn) (0.5.13)\n","Requirement already satisfied: umap-learn in /usr/local/lib/python3.10/dist-packages (from bbknn) (0.5.6)\n","Requirement already satisfied: scikit-learn>=1.0.2 in /usr/local/lib/python3.10/dist-packages (from bbknn) (1.3.2)\n","Requirement already satisfied: joblib>=1.1.1 in /usr/local/lib/python3.10/dist-packages (from scikit-learn>=1.0.2->bbknn) (1.4.2)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.10/dist-packages (from scikit-learn>=1.0.2->bbknn) (3.5.0)\n","Requirement already satisfied: python-dateutil>=2.8.2 in /usr/local/lib/python3.10/dist-packages (from pandas->bbknn) (2.9.0.post0)\n","Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas->bbknn) (2024.1)\n","Requirement already satisfied: tzdata>=2022.1 in /usr/local/lib/python3.10/dist-packages (from pandas->bbknn) (2024.1)\n","Requirement already satisfied: numba>=0.51.2 in /usr/local/lib/python3.10/dist-packages (from pynndescent->bbknn) (0.60.0)\n","Requirement already satisfied: llvmlite>=0.30 in /usr/local/lib/python3.10/dist-packages (from pynndescent->bbknn) (0.43.0)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.10/dist-packages (from umap-learn->bbknn) (4.66.5)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.10/dist-packages (from python-dateutil>=2.8.2->pandas->bbknn) (1.16.0)\n","Downloading bbknn-1.6.0-py3-none-any.whl (14 kB)\n","Downloading Cython-3.0.11-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (3.6 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m3.6/3.6 MB\u001b[0m \u001b[31m35.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hBuilding wheels for collected packages: annoy\n","  Building wheel for annoy (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for annoy: filename=annoy-1.17.3-cp310-cp310-linux_x86_64.whl size=550735 sha256=6b653dd5c79a36219aad9de013dae8780126a59c78cf27708f4fdd082f44f2d0\n","  Stored in directory: /root/.cache/pip/wheels/64/8a/da/f714bcf46c5efdcfcac0559e63370c21abe961c48e3992465a\n","Successfully built annoy\n","Installing collected packages: annoy, Cython, bbknn\n","Successfully installed Cython-3.0.11 annoy-1.17.3 bbknn-1.6.0\n"]}],"source":["!pip install bbknn"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"GbGVUQPk9Jt5"},"outputs":[],"source":["import os\n","import shutil\n","import bbknn\n","import scanpy as sc"]},{"cell_type":"markdown","metadata":{"id":"g1zbouA59iic"},"source":["### cleaning step"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":309,"status":"ok","timestamp":1726173464909,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"m6JtiQS99H4g","outputId":"67c3c74b-9ae1-499e-ea10-49b48ad9a10a"},"outputs":[{"name":"stdout","output_type":"stream","text":["Number of files with 'vs' in the name: 45\n"]}],"source":["\n","# # Create necessary folders\n","# os.makedirs('concat_adata', exist_ok=True)\n","# os.makedirs('raw_data', exist_ok=True)\n","# os.makedirs('integrated_adata', exist_ok=True)\n","\n","# # List all files in the current directory\n","# files = os.listdir('.')\n","\n","# # Separate vs and non-vs files\n","# vs_files = [file for file in files if 'vs' in file]\n","# non_vs_files = [file for file in files if 'vs' not in file]\n","\n","# # Move vs files to concat_adata folder\n","# for file in vs_files:\n","#     shutil.move(file, os.path.join('concat_adata', file))\n","\n","# # Move non-vs files to raw_data folder\n","# for file in non_vs_files:\n","#     if os.path.isfile(file):  # Ensure we don't move directories\n","#         shutil.move(file, os.path.join('raw_data', file))\n","\n","# print(f\"Number of files with 'vs' in the name: {len(vs_files)}\")\n"]},{"cell_type":"markdown","metadata":{"id":"b1dqLUbD9kqX"},"source":["### bbknn"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"HeyrD4in9hyy"},"outputs":[],"source":["def run_bbknn_integration(adata, batch_key='dataset'):\n","    \"\"\"\n","    Run PCA and BBKNN integration on the AnnData object.\n","    \"\"\"\n","    # Ensure PCA is computed\n","    sc.tl.pca(adata)\n","\n","    # Run BBKNN\n","    bbknn.bbknn(adata, batch_key=batch_key)\n","\n","    # Compute and plot UMAP\n","    sc.tl.umap(adata)\n","    sc.pl.umap(adata, color=[batch_key, 'celltype'], save=f'{batch_key}_cell_types_after_bbknn.png')\n","\n","    # Get unique batch values\n","    unique_batches = adata.obs[batch_key].unique()\n","\n","    # Create a filename based on the unique batch values\n","    batch_filename = f\"{'_'.join(unique_batches)}_integrated.h5ad\"\n","    integrated_file_name = os.path.join('integrated_adata', batch_filename)\n","\n","    # Save the integrated AnnData object\n","    adata.write(integrated_file_name)\n","    print(f\"Integrated AnnData saved to {integrated_file_name}\")\n","\n","    return adata\n","\n","\n","# Process all .h5ad files in the concat_adata folder\n","def process_all_files_in_concat_adata(batch_key='dataset'):\n","    # Define paths\n","    concat_adata_dir = 'concat_adata'\n","    integrated_adata_dir = 'integrated_adata'\n","\n","    # Ensure the integrated_adata folder exists\n","    os.makedirs(integrated_adata_dir, exist_ok=True)\n","\n","    # List all .h5ad files in the concat_adata directory\n","    files = [file for file in os.listdir(concat_adata_dir) if file.endswith('.h5ad')]\n","\n","    for file in files:\n","        file_path = os.path.join(concat_adata_dir, file)\n","\n","        # Load AnnData object\n","        print(f\"Loading {file_path}...\")\n","        adata = sc.read_h5ad(file_path)\n","\n","        # Run BBKNN integration\n","        print(f\"Running BBKNN on {file}...\")\n","        run_bbknn_integration(adata, batch_key=batch_key)\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000,"output_embedded_package_id":"1D-oS-vr2pi7YJUCPdfnMX6K4CDFSmGpk"},"executionInfo":{"elapsed":1640005,"status":"ok","timestamp":1726175694605,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"qtLGaT6M_bZo","outputId":"19a12200-cec6-46c4-9746-e17e89a93142"},"outputs":[{"output_type":"display_data","data":{"text/plain":"Output hidden; open in https://colab.research.google.com to view."},"metadata":{}}],"source":["# Example call to process all files in concat_adata\n","process_all_files_in_concat_adata(batch_key='dataset')"]},{"cell_type":"markdown","metadata":{"id":"V-Mld4G8Gf67"},"source":["## pseudotime (dpt)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"88G9Wg9AHERQ"},"outputs":[],"source":["import numpy as np"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"mLB2km6GM6CV"},"outputs":[],"source":["import os\n","os.chdir('/content/drive/MyDrive/Programmable Biology Group/Srikar/tf-flow-design/gonadal/data/')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"_gYCNoBIM9R1"},"outputs":[],"source":["# gonad = sc.read_h5ad(\"raw_data/human_germcells.h5ad\")"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":140,"status":"ok","timestamp":1726177844747,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"zCXgxjzrNrS3","outputId":"3f25bde7-2451-43e2-f708-a816702094a7"},"outputs":[{"data":{"text/plain":["['PGC', 'oogonia_STRA8', 'GC', 'oocyte', 'pre_oocyte', 'GC_mitotic', 'oogonia_meiotic', 'pre_spermatogonia']\n","Categories (8, object): ['GC', 'GC_mitotic', 'PGC', 'oocyte', 'oogonia_STRA8',\n","                         'oogonia_meiotic', 'pre_oocyte', 'pre_spermatogonia']"]},"execution_count":10,"metadata":{},"output_type":"execute_result"}],"source":["# gonad.obs['celltype'].unique()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ouwsvVnAGhSc"},"outputs":[],"source":["import os\n","import scanpy as sc\n","import numpy as np\n","\n","# Predefined hierarchy of differentiation stages\n","celltype_hierarchy = [\n","    'ipsc',\n","    'PGC',\n","    'pre-oocyte',\n","    'oogonia_STRA8',\n","    'oogonia_meiotic',\n","    'oocyte'\n","]\n","\n","# Function to perform pseudotime analysis\n","def perform_pseudotime_analysis(adata, start_class):\n","    \"\"\"\n","    Perform pseudotime analysis with a specified starting point.\n","    \"\"\"\n","    # Preprocessing steps\n","    sc.pp.normalize_total(adata, target_sum=1e4)\n","    sc.pp.log1p(adata)\n","    sc.pp.highly_variable_genes(adata)\n","    adata = adata[:, adata.var.highly_variable]\n","    sc.pp.scale(adata)\n","\n","    # Compute PCA and neighbors\n","    sc.tl.pca(adata)\n","    sc.pp.neighbors(adata, n_pcs=30, n_neighbors=30)\n","\n","    # UMAP and diffusion map\n","    sc.tl.umap(adata)\n","    sc.tl.diffmap(adata, n_comps=10)\n","    sc.pp.neighbors(adata, use_rep='X_diffmap')\n","\n","    # Set the root cell based on the specified starting point (start_class)\n","    start_mask = adata.obs['celltype'] == start_class\n","    if np.sum(start_mask) == 0:\n","        raise ValueError(f\"No cells found for starting class '{start_class}'\")\n","\n","    # Set the root cell for pseudotime analysis\n","    adata.uns['iroot'] = np.flatnonzero(start_mask)[0]\n","\n","    # Run DPT (pseudotime analysis)\n","    sc.tl.dpt(adata, n_dcs=10)\n","\n","    return adata\n","\n","# Determine the starting class based on the hierarchy and available celltypes in the dataset\n","def get_start_class(adata):\n","    \"\"\"\n","    Determine the starting class for pseudotime analysis based on the predefined celltype hierarchy.\n","    \"\"\"\n","    available_celltypes = adata.obs['celltype'].unique()\n","\n","    # Find the first cell type in the hierarchy that exists in the dataset\n","    for celltype in celltype_hierarchy:\n","        if celltype in available_celltypes:\n","            return celltype\n","    raise ValueError(\"No valid starting cell type found in the dataset.\")\n","\n","# Process all integrated AnnData files from the integrated_adata folder\n","def process_pseudotime_for_all():\n","    \"\"\"\n","    Run pseudotime analysis for all integrated files in the 'integrated_adata' folder.\n","    \"\"\"\n","    integrated_adata_dir = 'integrated_adata'\n","    pseudotime_dir = 'pseudotime'\n","\n","    # Ensure the integrated_adata folder exists\n","    if not os.path.exists(integrated_adata_dir):\n","        raise ValueError(f\"Directory {integrated_adata_dir} does not exist.\")\n","\n","    # Ensure the pseudotime folder exists\n","    if not os.path.exists(pseudotime_dir):\n","        os.makedirs(pseudotime_dir)\n","\n","    # List all .h5ad files in the integrated_adata directory\n","    files = [file for file in os.listdir(integrated_adata_dir) if file.endswith('.h5ad')]\n","\n","    # Define cell types to skip, excluding 'PGC'\n","    skip_types = ['_GC', 'GCmitotic', 'prespermatogonia']\n","\n","    for file in files:\n","        # Skip files related to specified cell types\n","        if any(skip_type in file for skip_type in skip_types):\n","            print(f\"Skipping file {file} as it contains cell type in skip list.\")\n","            continue\n","\n","        file_path = os.path.join(integrated_adata_dir, file)\n","\n","        # Load AnnData object\n","        print(f\"Loading {file_path}...\")\n","        adata = sc.read_h5ad(file_path)\n","\n","        # Determine the starting cell type for pseudotime analysis\n","        start_class = get_start_class(adata)\n","        print(f\"Starting pseudotime analysis with start class '{start_class}'...\")\n","\n","        # Perform pseudotime analysis\n","        adata = perform_pseudotime_analysis(adata, start_class)\n","\n","        # Save the result after pseudotime analysis\n","        output_file = os.path.join(pseudotime_dir, f'pseudotime_{file}')\n","        adata.write(output_file)\n","        print(f\"Pseudotime analysis completed and saved to {output_file}\")\n","\n","# call to process pseudotime for all integrated files\n","process_pseudotime_for_all()\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":163,"status":"ok","timestamp":1726181098063,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"j1VIBTmtaDjw","outputId":"4c155839-e514-4ada-acfc-f10000f8b72c"},"outputs":[{"name":"stdout","output_type":"stream","text":["['pseudotime_ipsc1_ipsc2_integrated.h5ad', 'pseudotime_ipsc1_gonad_PGC.h5ad_integrated.h5ad', 'pseudotime_ipsc1_gonad_oogoniaSTRA8.h5ad_integrated.h5ad', 'pseudotime_ipsc1_gonad_oocyte.h5ad_integrated.h5ad', 'pseudotime_ipsc1_gonad_preoocyte.h5ad_integrated.h5ad', 'pseudotime_ipsc1_gonad_oogoniameiotic.h5ad_integrated.h5ad', 'pseudotime_ipsc2_gonad_PGC.h5ad_integrated.h5ad', 'pseudotime_ipsc2_gonad_oogoniaSTRA8.h5ad_integrated.h5ad', 'pseudotime_ipsc2_gonad_oocyte.h5ad_integrated.h5ad', 'pseudotime_ipsc2_gonad_preoocyte.h5ad_integrated.h5ad', 'pseudotime_ipsc2_gonad_oogoniameiotic.h5ad_integrated.h5ad', 'pseudotime_gonad_PGC.h5ad_gonad_oogoniaSTRA8.h5ad_integrated.h5ad', 'pseudotime_gonad_PGC.h5ad_gonad_oocyte.h5ad_integrated.h5ad', 'pseudotime_gonad_PGC.h5ad_gonad_preoocyte.h5ad_integrated.h5ad', 'pseudotime_gonad_PGC.h5ad_gonad_oogoniameiotic.h5ad_integrated.h5ad', 'pseudotime_gonad_oogoniaSTRA8.h5ad_gonad_oocyte.h5ad_integrated.h5ad', 'pseudotime_gonad_oogoniaSTRA8.h5ad_gonad_preoocyte.h5ad_integrated.h5ad', 'pseudotime_gonad_oogoniaSTRA8.h5ad_gonad_oogoniameiotic.h5ad_integrated.h5ad', 'pseudotime_gonad_oocyte.h5ad_gonad_preoocyte.h5ad_integrated.h5ad', 'pseudotime_gonad_oocyte.h5ad_gonad_oogoniameiotic.h5ad_integrated.h5ad', 'pseudotime_gonad_preoocyte.h5ad_gonad_oogoniameiotic.h5ad_integrated.h5ad']\n","21\n"]}],"source":["dest_dir = 'pseudotime'\n","# list files in dest_dir\n","dest_files = [file for file in os.listdir(dest_dir) if file.endswith('.h5ad')]\n","print(dest_files)\n","print(len(dest_files))"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":159,"status":"ok","timestamp":1726181141013,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"_eP7XacTadSF","outputId":"33d549cf-6689-4453-e55b-6ce4bd88e8b1"},"outputs":[{"data":{"text/plain":["['pseudotime_ipsc1_ipsc2_integrated.h5ad',\n"," 'pseudotime_ipsc1_gonad_PGC.h5ad_integrated.h5ad',\n"," 'pseudotime_ipsc1_gonad_oogoniaSTRA8.h5ad_integrated.h5ad',\n"," 'pseudotime_ipsc1_gonad_oocyte.h5ad_integrated.h5ad',\n"," 'pseudotime_ipsc1_gonad_preoocyte.h5ad_integrated.h5ad',\n"," 'pseudotime_ipsc1_gonad_oogoniameiotic.h5ad_integrated.h5ad',\n"," 'pseudotime_ipsc2_gonad_PGC.h5ad_integrated.h5ad',\n"," 'pseudotime_ipsc2_gonad_oogoniaSTRA8.h5ad_integrated.h5ad',\n"," 'pseudotime_ipsc2_gonad_oocyte.h5ad_integrated.h5ad',\n"," 'pseudotime_ipsc2_gonad_preoocyte.h5ad_integrated.h5ad',\n"," 'pseudotime_ipsc2_gonad_oogoniameiotic.h5ad_integrated.h5ad',\n"," 'pseudotime_gonad_PGC.h5ad_gonad_oogoniaSTRA8.h5ad_integrated.h5ad',\n"," 'pseudotime_gonad_PGC.h5ad_gonad_oocyte.h5ad_integrated.h5ad',\n"," 'pseudotime_gonad_PGC.h5ad_gonad_preoocyte.h5ad_integrated.h5ad',\n"," 'pseudotime_gonad_PGC.h5ad_gonad_oogoniameiotic.h5ad_integrated.h5ad',\n"," 'pseudotime_gonad_oogoniaSTRA8.h5ad_gonad_oocyte.h5ad_integrated.h5ad',\n"," 'pseudotime_gonad_oogoniaSTRA8.h5ad_gonad_preoocyte.h5ad_integrated.h5ad',\n"," 'pseudotime_gonad_oogoniaSTRA8.h5ad_gonad_oogoniameiotic.h5ad_integrated.h5ad',\n"," 'pseudotime_gonad_oocyte.h5ad_gonad_preoocyte.h5ad_integrated.h5ad',\n"," 'pseudotime_gonad_oocyte.h5ad_gonad_oogoniameiotic.h5ad_integrated.h5ad',\n"," 'pseudotime_gonad_preoocyte.h5ad_gonad_oogoniameiotic.h5ad_integrated.h5ad']"]},"execution_count":18,"metadata":{},"output_type":"execute_result"}],"source":["dest_files"]},{"cell_type":"markdown","metadata":{"id":"RawcsYLAaqNL"},"source":["## gene regulatory nets"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2608,"status":"ok","timestamp":1726181356525,"user":{"displayName":"Venkata Srikar Kavirayuni","userId":"10910189441313353201"},"user_tz":420},"id":"96nkqfwNapVM","outputId":"5da76972-c92f-4606-f24a-b7f2bb7d628b"},"outputs":[{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/dask/dataframe/__init__.py:42: FutureWarning: \n","Dask dataframe query planning is disabled because dask-expr is not installed.\n","\n","You can install it with `pip install dask[dataframe]` or `conda install dask`.\n","This will raise in a future version.\n","\n","  warnings.warn(msg, FutureWarning)\n"]}],"source":["import sys\n","os.chdir('/content/drive/MyDrive/Programmable Biology Group/Srikar/tf-flow-design/arboreto/')\n","sys.path.append(os.getcwd())\n","\n","from arboreto.utils import load_tf_names\n","from arboreto.algo import grnboost2"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"j9v2uFQUbT2P"},"outputs":[],"source":["import os\n","os.chdir('/content/drive/MyDrive/Programmable Biology Group/Srikar/tf-flow-design/gonadal/data')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"c2TYgg-ebXAU"},"outputs":[],"source":["import scanpy as sc\n","import numpy as np\n","import pandas as pd"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"1es2XGcUbdKE"},"outputs":[],"source":["\n","reg_nets_dir = 'reg_nets'\n","if not os.path.exists(reg_nets_dir):\n","    os.makedirs(reg_nets_dir)\n","\n","def run_grnboost2(adata):\n","    expression_matrix = adata.to_df()\n","    adjacency_matrix = grnboost2(expression_data=expression_matrix, verbose=True)\n","    return adjacency_matrix\n","\n","def process_grnboost2_for_all():\n","    pseudotime_dir = 'pseudotime'\n","    files = [file for file in os.listdir(pseudotime_dir) if file.endswith('.h5ad')]\n","\n","    for file in files:\n","        output_file = os.path.join(reg_nets_dir, f'adjacency_{file.replace(\".h5ad\", \".csv\")}')\n","        if os.path.exists(output_file):\n","            print(f\"Skipping {file} as adjacency matrix already exists.\")\n","            continue\n","\n","        file_path = os.path.join(pseudotime_dir, file)\n","        adata = sc.read_h5ad(file_path)\n","        adjacency_matrix = run_grnboost2(adata)\n","        adjacency_matrix.to_csv(output_file)\n","        print(f\"Adjacency matrix saved to {output_file}\")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"id":"ugRymtfkbori","outputId":"71adad2e-2578-46c0-b4a5-e8c5359241d8"},"outputs":[{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/anndata/_core/anndata.py:1754: UserWarning: Observation names are not unique. To make them unique, call `.obs_names_make_unique`.\n","  utils.warn_names_duplicates(\"obs\")\n"]},{"name":"stdout","output_type":"stream","text":["preparing dask client\n"]},{"name":"stderr","output_type":"stream","text":["INFO:distributed.http.proxy:To route to workers diagnostics web server please install jupyter-server-proxy: python -m pip install jupyter-server-proxy\n","INFO:distributed.scheduler:State start\n","INFO:distributed.scheduler:  Scheduler at:     tcp://127.0.0.1:38341\n","INFO:distributed.scheduler:  dashboard at:  http://127.0.0.1:8787/status\n","INFO:distributed.scheduler:Registering Worker plugin shuffle\n","INFO:distributed.nanny:        Start Nanny at: 'tcp://127.0.0.1:37173'\n","INFO:distributed.nanny:        Start Nanny at: 'tcp://127.0.0.1:35063'\n","INFO:distributed.scheduler:Register worker <WorkerState 'tcp://127.0.0.1:41931', name: 1, status: init, memory: 0, processing: 0>\n","INFO:distributed.scheduler:Starting worker compute stream, tcp://127.0.0.1:41931\n","INFO:distributed.core:Starting established connection to tcp://127.0.0.1:49840\n","INFO:distributed.scheduler:Register worker <WorkerState 'tcp://127.0.0.1:42811', name: 0, status: init, memory: 0, processing: 0>\n","INFO:distributed.scheduler:Starting worker compute stream, tcp://127.0.0.1:42811\n","INFO:distributed.core:Starting established connection to tcp://127.0.0.1:49824\n","INFO:distributed.scheduler:Receive client connection: Client-8e94adac-7159-11ef-81b2-0242ac1c000c\n","INFO:distributed.core:Starting established connection to tcp://127.0.0.1:49852\n"]},{"name":"stdout","output_type":"stream","text":["parsing input\n","creating dask graph\n","2 partitions\n","computing dask graph\n"]},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.10/dist-packages/distributed/client.py:3357: UserWarning: Sending large graph of size 493.03 MiB.\n","This may cause some slowdown.\n","Consider scattering data ahead of time and using futures.\n","  warnings.warn(\n"]}],"source":["process_grnboost2_for_all()\n"]}],"metadata":{"accelerator":"TPU","colab":{"collapsed_sections":["_rjYSzJaDPyu","S5jLIxFWDJUX","XX-74OlxQPE3","xIDBxfTUDToQ","dVPLafaG6iwh","b1dqLUbD9kqX"],"gpuType":"V28","provenance":[],"mount_file_id":"1KPGJrJY5Gm0lw8TzkXyigtyQ_VzRxhOy","authorship_tag":"ABX9TyPGSx/Dsx6XCBuhKxnvqkTt"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}